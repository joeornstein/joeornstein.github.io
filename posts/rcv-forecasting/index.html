<!doctype html>

<html lang="en">

<head>
  <title>Joseph T. Ornstein</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="The HTML5 Herald" />
<meta name="author" content="Joseph T. Ornstein" /><meta property="og:title" content="Forecasting the NYC Ranked Choice Mayoral Primary" />
<meta property="og:description" content="As of July 3, 2021, the ranked choice voting (RCV) race for New York City mayor is hotly contested. An unofficial RCV result counting only in-person Election Day ballots projected a close Adams win over Garcia in the final round of elimination." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://joeornstein.github.io/posts/rcv-forecasting/" />
<meta property="article:published_time" content="2021-07-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-07-03T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Forecasting the NYC Ranked Choice Mayoral Primary"/>
<meta name="twitter:description" content="As of July 3, 2021, the ranked choice voting (RCV) race for New York City mayor is hotly contested. An unofficial RCV result counting only in-person Election Day ballots projected a close Adams win over Garcia in the final round of elimination."/>

<meta name="generator" content="Hugo 0.69.0" />
    
    <link rel="shortcut icon" href="https://joeornstein.github.io/images/favicon_io/favicon.ico" />
  

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://joeornstein.github.io/fontawesome/css/all.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="https://joeornstein.github.io/css/styles.css" /></head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="https://joeornstein.github.io/">Joseph T. Ornstein</a>
            </h1>

      <ul id="social-media">
             <li>
               <a href="https://github.com/joeornstein" title="GitHub">
               <i class="fab fa-github fa-lg"></i>
               </a>
             </li>
             <li>
               <a href="https://twitter.com/joeornstein" title="Twitter">
               <i class="fab fa-twitter fa-lg"></i>
               </a>
             </li>
             <li>
               <a href="https://scholar.google.com/citations?user=HXC86u8AAAAJ&amp;hl=en" title="Google Scholar">
               <i class="fab fa-google fa-lg"></i>
               </a>
             </li>
      </ul>
      
      <p><em>Assistant Professor of Political Science, University of Georgia</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="https://joeornstein.github.io/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Archives</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://joeornstein.github.io/publications/">
                <i class="fa-li fa  fa-lg"></i><span>Publications</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://joeornstein.github.io/teaching/">
                <i class="fa-li fa  fa-lg"></i><span>Teaching</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://joeornstein.github.io/resources/">
                <i class="fa-li fa  fa-lg"></i><span>Resources</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>


<link rel="stylesheet" href="https://joeornstein.github.io/css/atom-one-dark.css" rel="stylesheet" id="theme-stylesheet">
<script src="https://joeornstein.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<article>

    <h1>Forecasting the NYC Ranked Choice Mayoral Primary</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2021-07-03T00:00:00Z">Jul 3, 2021</time>
        </li>
        
        <li>
            Categories:
            <em>
                
                    
                    <a href="https://joeornstein.github.io/categories/data-science">Data Science</a>
                
                    , 
                    <a href="https://joeornstein.github.io/categories/elections">Elections</a>
                
            </em>
        </li>
        

        

        <li>9 minutes read</li>
    </ul>
</aside>

    

    
<div class="featured_image">
    <a href="https://joeornstein.github.io/posts/rcv-forecasting/" title="Forecasting the NYC Ranked Choice Mayoral Primary">
        <img src="">
    </a>
</div>



    
<script src="https://joeornstein.github.io/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>As of July 3, 2021, the ranked choice voting (RCV) race for New York City mayor is hotly contested. An unofficial RCV result counting only in-person Election Day ballots projected a close Adams win over Garcia in the final round of elimination. But there are over <a href="https://www.nytimes.com/2021/07/02/nyregion/nyc-mayor-race-voting-count-eric-adams.html">125,000 absentee ballots</a> left to count. Will those ballots be enough for Garcia to overtake Adams? (Or for Wiley to overtake Garcia?) Here’s a quick-and-dirty peek at the data.</p>
<div id="clean-the-data" class="section level2">
<h2>Clean The Data</h2>
<p>Without the ballot image data, we’ll need to work with three sets of data: (1) the <a href="https://web.enrboenyc.us/rcv/024306_1.html">unofficial ranked choice results</a> as of July 1, to get a sense of the likely sequence of eliminations and transfers, (2) counts of absentee ballots returned by assembly district, and (3) <a href="https://web.enrboenyc.us/CD24306ADI0.html">district-level first-place vote counts</a> from Election Day, to get a sense of who those absentee ballots will support.</p>
<p>First, let’s create a transition matrix <span class="math inline">\(P\)</span> with the projected eliminations and the redistribution of voter support. To make it easy on ourselves, we’ll focus on the top four candidates (Adams, Wiley, Garcia, and Yang); all other votes, including write-ins, will be labeled “Other”.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<pre class="r"><code>library(tidyverse)
library(readxl)

# load the unofficial RCV transfers
rcv_transfers &lt;- read_xlsx(&#39;data/rcv-transfers.xlsx&#39;)

# convert to a matrix
elimination_sequence &lt;- as.matrix(rcv_transfers[,2:5])
rownames(elimination_sequence) &lt;- rcv_transfers$candidate

elimination_sequence</code></pre>
<pre><code>##           Round 1 Round 7 Round 8 Round 9
## Adams      260455  283142  314194  358521
## Wiley      181590  213857  226575       0
## Garcia     158221  190106  226922  343766
## Yang        96005  111239       0       0
## Other      123343       0       0       0
## Exhausted       0   21270   51923  117327</code></pre>
<pre class="r"><code># in the preliminary tally, votes for &#39;other&#39; candidates transferred to the four major candidates as follows
other_transfers &lt;- (elimination_sequence[,2] - elimination_sequence[,1]) / elimination_sequence[5,1]
other_transfers</code></pre>
<pre><code>##      Adams      Wiley     Garcia       Yang      Other  Exhausted 
##  0.1839342  0.2616038  0.2585068  0.1235092 -1.0000000  0.1724459</code></pre>
<pre class="r"><code># Yang votes transferred as follows
yang_transfers &lt;- (elimination_sequence[,3] - elimination_sequence[,2]) / elimination_sequence[4,2]
yang_transfers</code></pre>
<pre><code>##      Adams      Wiley     Garcia       Yang      Other  Exhausted 
##  0.2791467  0.1143304  0.3309631 -1.0000000  0.0000000  0.2755598</code></pre>
<pre class="r"><code># and Wiley transfers...
wiley_transfers &lt;- (elimination_sequence[,4] - elimination_sequence[,3]) / elimination_sequence[2,3]
wiley_transfers</code></pre>
<pre><code>##      Adams      Wiley     Garcia       Yang      Other  Exhausted 
##  0.1956394 -1.0000000  0.5156968  0.0000000  0.0000000  0.2886638</code></pre>
<p>If Wiley is eliminated, expect 51% of her votes to go to Garcia, 19% to go to Adams, and 28% to be exhausted. Now we can construct the transition matrix <span class="math inline">\(P\)</span>.</p>
<pre class="r"><code>P &lt;- rbind(c(1,0,0,0,0,0),
           wiley_transfers,
           c(0,0,1,0,0,0),
           yang_transfers,
           other_transfers,
           c(0,0,0,0,0,1))
rownames(P) &lt;- colnames(P)
# zeroes in the diagonals for eliminated candidates (transient states)
P[&#39;Wiley&#39;,&#39;Wiley&#39;] &lt;- 0 
P[&#39;Yang&#39;,&#39;Yang&#39;] &lt;- 0
P[&#39;Other&#39;,&#39;Other&#39;] &lt;- 0

P</code></pre>
<pre><code>##               Adams     Wiley    Garcia      Yang Other Exhausted
## Adams     1.0000000 0.0000000 0.0000000 0.0000000     0 0.0000000
## Wiley     0.1956394 0.0000000 0.5156968 0.0000000     0 0.2886638
## Garcia    0.0000000 0.0000000 1.0000000 0.0000000     0 0.0000000
## Yang      0.2791467 0.1143304 0.3309631 0.0000000     0 0.2755598
## Other     0.1839342 0.2616038 0.2585068 0.1235092     0 0.1724459
## Exhausted 0.0000000 0.0000000 0.0000000 0.0000000     0 1.0000000</code></pre>
<p>Run that Markov Chain forward a few rounds and you get the matrix <span class="math inline">\(B\)</span>, which reports the probability that a first-place vote for row candidate <span class="math inline">\(i\)</span> will ultimately be transferred to column candidate <span class="math inline">\(j\)</span> (or the ballot will be Exhausted):</p>
<pre class="r"><code># multiply the transition matrix by itself to compute the absorbing state probabilities
B &lt;- P %*% P %*% P %*% P

B</code></pre>
<pre><code>##               Adams Wiley    Garcia Yang Other Exhausted
## Adams     1.0000000     0 0.0000000    0     0 0.0000000
## Wiley     0.1956394     0 0.5156968    0     0 0.2886638
## Garcia    0.0000000     0 1.0000000    0     0 0.0000000
## Yang      0.3015142     0 0.3899229    0     0 0.3085629
## Other     0.2723540     0 0.4415741    0     0 0.2860719
## Exhausted 0.0000000     0 0.0000000    0     0 1.0000000</code></pre>
<p>First-place votes for Wiley are worth roughly 0.52 votes for Garcia, but only 0.2 votes for Adams. First-place votes for Yang are worth 0.39 for Garcia and 0.3 votes for Adams respectively, assuming that the order of eliminations is the same after they tally the absentee ballots.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<pre class="r"><code># multiply the first round vote vector with the matrix B, and you should get the final round vote vector
elimination_sequence[,1] %*% B</code></pre>
<pre><code>##       Adams Wiley Garcia Yang Other Exhausted
## [1,] 358521     0 343766    0     0    117327</code></pre>
<p>With that pinned down, we can look at the Election Day results by assembly district, (available <a href="https://web.enrboenyc.us/CD24306ADI0.html">here</a>), see how many absentee ballots are left to count in each of those districts, and estimate how the absentee ballots will affect the final results.</p>
<pre class="r"><code># load first-pick data from election night
d &lt;- read_xlsx(&#39;data/election-night-results.xlsx&#39;) %&gt;% 
  # collapse the non-top-four candidates
  mutate(other = Foldenauer + Morales + Stringer + McGuire +
           Prince + Chang + Wright + Donovan + Taylor + `Write-in`) %&gt;% 
  select(borough, assembly_district, Adams, Wiley, Garcia, Yang, other) %&gt;% 
  # reshape longer
  pivot_longer(cols = &#39;Adams&#39;:&#39;other&#39;,
               values_to = &#39;votes&#39;,
               names_to = &#39;candidate&#39;) %&gt;% 
  # reformat some variables
  mutate(assembly_district = assembly_district %&gt;% str_replace_all(&#39;AD &#39;, &#39;&#39;) %&gt;% as.numeric,
         candidate = str_to_title(candidate),
         candidate = factor(candidate, levels = rownames(B))) %&gt;%
  # compute the share of votes received by candidates in each assembly district
  group_by(borough, assembly_district) %&gt;% 
  summarize(candidate = candidate,
            votes = votes,
            ad_share = votes / sum(votes))

election_night_vote_totals &lt;- d %&gt;% 
  group_by(candidate) %&gt;%
  summarize(first_place_votes = sum(votes))

election_night_vote_totals</code></pre>
<pre><code>## # A tibble: 5 x 2
##   candidate first_place_votes
##   &lt;fct&gt;                 &lt;dbl&gt;
## 1 Adams                253234
## 2 Wiley                177722
## 3 Garcia               155812
## 4 Yang                  93291
## 5 Other                119768</code></pre>
<p>Here are the assembly districts where absentee ballots still need to be counted:</p>
<pre class="r"><code>absentee_ballots &lt;- read_xlsx(&#39;data/absentee-ballots.xlsx&#39;)

# merge with the election night vote totals
d &lt;- d %&gt;% 
  left_join(absentee_ballots, by = c(&#39;borough&#39;, &#39;assembly_district&#39;))

d %&gt;% 
  ggplot() +
  geom_point(mapping = aes(x=absentee_ballots_returned,
                           y=ad_share),
             alpha = 0.4) +
  facet_wrap(~candidate) +
  labs(x = &#39;Absentee Ballots Left To Count&#39;,
       y = &quot;Vote Share (Election Night)&quot;) +
  theme_bw()</code></pre>
<p><img src="https://joeornstein.github.io/posts/rcv-forecasting/index_files/figure-html/absentee%20ballots-1.png" width="672" /></p>
</div>
<div id="estimating-absentee-support" class="section level2">
<h2>Estimating Absentee Support</h2>
<p>If absentee voters look like the Election Day voters from their districts, then you can take the dot product from each of those charts above to forecast the support that each will receive from absentee ballots. Under this (big) assumption, Adams receives the most first-place absentee votes.</p>
<pre class="r"><code># projected votes
d &lt;- d %&gt;% 
  mutate(projected_absentee_votes = absentee_ballots_returned * ad_share,
         projected_first_place_votes = votes + projected_absentee_votes)

d %&gt;% 
  group_by(candidate) %&gt;% 
  summarize(projected_absentee_votes = sum(projected_absentee_votes)) %&gt;% 
  mutate(share_absentee_votes = projected_absentee_votes / sum(projected_absentee_votes))</code></pre>
<pre><code>## # A tibble: 5 x 3
##   candidate projected_absentee_votes share_absentee_votes
##   &lt;fct&gt;                        &lt;dbl&gt;                &lt;dbl&gt;
## 1 Adams                       36506.                0.291
## 2 Wiley                       25394.                0.202
## 3 Garcia                      26912.                0.214
## 4 Yang                        17012.                0.135
## 5 Other                       19745.                0.157</code></pre>
<p>Because Wiley votes are worth 0.52 votes for Garcia, this narrows the final gap between Adams and Garcia, but will it be by enough to give Garcia the edge? Perform the transfers by multiplying the first-round vector by the absorbing state matrix <span class="math inline">\(B\)</span>.</p>
<pre class="r"><code>projected_votes &lt;- d %&gt;% 
  group_by(candidate, .drop = FALSE) %&gt;% # .drop = FALSE keeps factor levels that don&#39;t appear in the data
  summarize(first_place_votes = sum(projected_first_place_votes))

projected_votes</code></pre>
<pre><code>## # A tibble: 6 x 2
##   candidate first_place_votes
##   &lt;fct&gt;                 &lt;dbl&gt;
## 1 Adams               289740.
## 2 Wiley               203116.
## 3 Garcia              182724.
## 4 Yang                110303.
## 5 Other               139513.
## 6 Exhausted                0</code></pre>
<pre class="r"><code>final &lt;- (projected_votes$first_place_votes %*% B)[1,]
final</code></pre>
<pre><code>##     Adams     Wiley    Garcia      Yang     Other Exhausted 
##  400732.8       0.0  392085.6       0.0       0.0  132578.5</code></pre>
<pre class="r"><code># two-candidate vote share
final[&#39;Adams&#39;] / (final[&#39;Adams&#39;] + final[&#39;Garcia&#39;]) * 100</code></pre>
<pre><code>##    Adams 
## 50.54535</code></pre>
<p>With the absentee ballots counted, the final round gap between Adams and Garcia narrows to about 8,647 votes. It’s a squeaker, but geography alone won’t save Garcia. For her to win, the absentee ballots must be significantly worse for Adams than their geographic distribution would suggest.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
</div>
<div id="what-about-wiley" class="section level2">
<h2>What about Wiley?</h2>
<p>Are the absentee ballots likely to put Wiley over Garcia in Round 8?</p>
<pre class="r"><code>projected_round_1 &lt;- projected_votes$first_place_votes
names(projected_round_1) &lt;- projected_votes$candidate

# transfer votes from other candidates
projected_round_7 &lt;- projected_round_1 + projected_round_1[&#39;Other&#39;] * other_transfers

round( projected_round_7 )</code></pre>
<pre><code>##     Adams     Wiley    Garcia      Yang     Other Exhausted 
##    315402    239613    218789    127534         0     24058</code></pre>
<pre class="r"><code># transfer votes from Yang
projected_round_8 &lt;- projected_round_7 + projected_round_7[&#39;Yang&#39;] * yang_transfers

round( projected_round_8 )</code></pre>
<pre><code>##     Adams     Wiley    Garcia      Yang     Other Exhausted 
##    351002    254194    260998         0         0     59202</code></pre>
<p>Nope. The margin between Garcia and Wiley grows even larger – to 6,803 votes.</p>
</div>
<div id="final-thoughts" class="section level2">
<h2>Final Thoughts</h2>
<p>Right now, I wouldn’t be surprised if Garcia won<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>, but I give the edge to Adams. As this post was going to press, the <em>New York Times</em> <a href="https://www.nytimes.com/2021/07/02/nyregion/nyc-mayor-race-voting-count-eric-adams.html">reported</a> an early unofficial count of absentee ballots in Manhattan, showing Garcia as a first-choice on 9,043 of the 23,739 absentee ballots counted in the borough, and Adams as first choice on 2,999. That’s a wide margin (38% vs 13%), but it’s not much more favorable to Garcia than the Election Day results from those Manhattan districts would suggest:</p>
<pre class="r"><code>d %&gt;% 
  filter(borough == &#39;manhattan&#39;) %&gt;% 
  group_by(candidate) %&gt;% 
  summarize(projected_absentee_votes = sum(projected_absentee_votes)) %&gt;% 
  mutate(share_absentee_votes = projected_absentee_votes / sum(projected_absentee_votes))</code></pre>
<pre><code>## # A tibble: 5 x 3
##   candidate projected_absentee_votes share_absentee_votes
##   &lt;fct&gt;                        &lt;dbl&gt;                &lt;dbl&gt;
## 1 Adams                        6824.               0.172 
## 2 Wiley                        8332.               0.210 
## 3 Garcia                      13864.               0.350 
## 4 Yang                         3927.               0.0992
## 5 Other                        6649.               0.168</code></pre>
<p>Assume that Adams underperforms his Election Day numbers by that same margin on absentee ballots in every borough. Would that be enough for Garcia to win?</p>
<pre class="r"><code>d &lt;- d %&gt;% 
  # downweight Adams&#39; assembly district shares
  mutate(revised_ad_share = if_else(candidate == &#39;Adams&#39;, ad_share - (0.172 - 0.126), ad_share)) %&gt;% 
  # all the Adams votes get divided equally between Garcia and Wiley
  group_by(borough, assembly_district) %&gt;% 
  mutate(revised_ad_share = if_else(candidate %in% c(&#39;Garcia&#39;, &#39;Wiley&#39;), revised_ad_share + (0.172 - 0.126) / 2, revised_ad_share)) %&gt;% 
  # reproject absentee votes
  mutate(projected_absentee_votes = absentee_ballots_returned * revised_ad_share,
         projected_first_place_votes = votes + projected_absentee_votes)

projected_votes &lt;- d %&gt;% 
  group_by(candidate, .drop = FALSE) %&gt;% # .drop = FALSE keeps factor levels that don&#39;t appear in the data
  summarize(first_place_votes = sum(projected_first_place_votes))

projected_votes</code></pre>
<pre><code>## # A tibble: 6 x 2
##   candidate first_place_votes
##   &lt;fct&gt;                 &lt;dbl&gt;
## 1 Adams               283964.
## 2 Wiley               206004.
## 3 Garcia              185612.
## 4 Yang                110303.
## 5 Other               139513.
## 6 Exhausted                0</code></pre>
<pre class="r"><code>final &lt;- (projected_votes$first_place_votes %*% B)[1,]
final</code></pre>
<pre><code>##     Adams     Wiley    Garcia      Yang     Other Exhausted 
##  395521.7       0.0  396463.1       0.0       0.0  133412.2</code></pre>
<p>She would win by about 941 votes! Well now I have no idea. <a href="https://www.predictit.org/markets/detail/7002/Who-will-be-elected-New-York-City-mayor-in-2021">PredictIt</a> gives roughly even odds to both candidates today, and that seems about right to me.</p>
</div>
<div id="acknowledgments" class="section level2">
<h2>Acknowledgments</h2>
<p>Thanks to <a href="https://www.imdb.com/name/nm4955790/?ref_=m_nmfm_nm">Ryan Beitzell</a> for research assistance.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Some candidates are eliminated simultaneously, which makes it difficult to construct a transition matrix including each of the first 10 candidates eliminated.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>A <em>big</em> if! Without data on the complete preference rankings of voters, we don’t know what would happen if, say, Garcia were eliminated instead of Wiley. But, as we’ll see, the geographic distribution of absentee ballots doesn’t suggest that Wiley is likely to overtake Garcia in the penultimate round.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>They probably will be! Absentee voters tend to be better educated than Election Day voters, a group that is more likely to support Garcia and Wiley. But note that part of that effect is already captured in the geographic distribution of the absentee ballots (e.g. a lot of absentee ballots returned in the neighborhoods around Central Park).<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>And to be clear, if Garcia wins, it wouldn’t be a “come from behind victory”. It would be because more people voted for Garcia over Adams than voted for Adams over Garcia. The sequential eliminations in RCV make it <em>seem</em> like a horse race where a candidate with an early lead gets overtaken by an underdog, but that’s just accounting.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="https://joeornstein.github.io/posts/poll-wrangling/"><i class="fa fa-chevron-circle-left"></i> Poll Wrangling</a>
        </li>
        
        
        <li>
            <a href="https://joeornstein.github.io/posts/regression-puzzle/">Regression Puzzle <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
    
    





</main>
    <footer>
        <h6>Copyright © 2020 - Joseph T. Ornstein |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a>
    </footer>
</div>
<script src="https://joeornstein.github.io/js/scripts.js"></script>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-166301409-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
