<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joe Ornstein">

<title>Introduction to Political Methodology - Week 10: Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./img/favicon_io/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Introduction to Political Methodology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./syllabus/POLS-7012-syllabus.pdf" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-schedule" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Schedule</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-schedule">    
        <li class="dropdown-header">PART 1: FUNDAMENTALS</li>
        <li>
    <a class="dropdown-item" href="./01-introduction.html" rel="" target="">
 <span class="dropdown-text">Week 1: Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-writing-code.html" rel="" target="">
 <span class="dropdown-text">Week 2: Writing Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-experiments.html" rel="" target="">
 <span class="dropdown-text">Week 3: Experiments</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-samples.html" rel="" target="">
 <span class="dropdown-text">Week 4: Samples</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-linear-model.html" rel="" target="">
 <span class="dropdown-text">Week 5: The Linear Model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-causality.html" rel="" target="">
 <span class="dropdown-text">Week 6: Causality</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-probability.html" rel="" target="">
 <span class="dropdown-text">Week 7: Probability</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./08-uncertainty.html" rel="" target="">
 <span class="dropdown-text">Week 8: Uncertainty</span></a>
  </li>  
        <li class="dropdown-header">PART 2: APPLICATIONS</li>
        <li>
    <a class="dropdown-item" href="./09-visualization.html" rel="" target="">
 <span class="dropdown-text">Week 9: Data Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-wrangling.html" rel="" target="">
 <span class="dropdown-text">Week 10: Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11-tidying.html" rel="" target="">
 <span class="dropdown-text">Week 11: Data Tidying</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12-importing-exporting.html" rel="" target="">
 <span class="dropdown-text">Week 12: Data Importing/Exporting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13-joining.html" rel="" target="">
 <span class="dropdown-text">Week 13: Data Joining</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./14-wrap-up.html" rel="" target="">
 <span class="dropdown-text">Weeks 14-15: Wrapping Up</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://uga.view.usg.edu/d2l/home/3240411" rel="" target=""><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://app.perusall.com/courses/introduction-to-political-methodology/" rel="" target=""><i class="bi bi-book-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/joeornstein/intro-political-methodology" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#reading" id="toc-reading" class="nav-link active" data-scroll-target="#reading">Reading</a></li>
  <li><a href="#problem-set" id="toc-problem-set" class="nav-link" data-scroll-target="#problem-set">Problem Set</a></li>
  <li><a href="#class-notes" id="toc-class-notes" class="nav-link" data-scroll-target="#class-notes">Class Notes</a>
  <ul class="collapse">
  <li><a href="#importing-the-data" id="toc-importing-the-data" class="nav-link" data-scroll-target="#importing-the-data">Importing The Data</a></li>
  <li><a href="#recoding-variables" id="toc-recoding-variables" class="nav-link" data-scroll-target="#recoding-variables">Recoding Variables</a></li>
  <li><a href="#joining-datasets" id="toc-joining-datasets" class="nav-link" data-scroll-target="#joining-datasets">Joining Datasets</a></li>
  <li><a href="#selecting-variables" id="toc-selecting-variables" class="nav-link" data-scroll-target="#selecting-variables">Selecting Variables</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 10: Data Wrangling</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joe Ornstein </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>Up to now, we’ve been working with pretty tidy datasets. Every column is a variable, every row is an observation, and every value is where it should be. But things are not always this way. More often than you’re going to like, data comes to you an unruly mess, and you’ll need to tidy it up before you can even start to explore it.</p>
<p>This week, we’ll learn some of the most important functions in the <code>tidyverse</code> for data wrangling. By the end of the week, you will be able to:</p>
<ul>
<li><p>Filter the rows of a dataset using conditional logic with the <code>filter()</code> function</p></li>
<li><p>Select and rename columns using the <code>select()</code> function</p></li>
<li><p>Create new variables and modify existing ones using the <code>mutate()</code> function</p></li>
<li><p>Properly format categorical variables, with the help of functions like <code>case_when()</code> and <code>factor()</code></p></li>
<li><p>Perform a basic data merge with <code>left_join()</code></p></li>
</ul>
<section id="reading" class="level1">
<h1>Reading</h1>
<ul>
<li><p><strong>R4DS</strong> Chapters 3-4</p></li>
<li><p><strong>R4DS</strong> Chapter 12</p></li>
</ul>
</section>
<section id="problem-set" class="level1">
<h1>Problem Set</h1>
<p>This week, we’re going to be summarizing different variables from the CES 2020 dataset. You’ll need to download the dataset (see instructions in the class notes below) and use the codebook to identify which variables contain the information you want, tidy them up, and then summarize. Write an <code>R</code> script that performs these tasks, compile a PDF report, and submit the report.</p>
<p>Here are the questions I’d like you to answer:</p>
<ol type="1">
<li><p>Are labor union members more likely to be Democrats or Republicans?</p></li>
<li><p>Compare the average age of people with landline phones, compared to those who only have cell phones? Estimate the difference-in-means and report the p-value from a null hypothesis test.</p></li>
<li><p>Are people who read the newspaper more likely to correctly answer the questions about who controls the US House of Representatives and US Senate? (Remember, this survey was conducted at the end of 2020.)</p></li>
<li><p>Create a bar chart reporting the percent of respondents in each religious group that support making abortion illegal in all circumstances.</p></li>
<li><p><strong>Bonus</strong>. The CES oversamples some respondents relative to their frequency among registered voters in order to get a better statistical picture of some smaller subgroups. The dataset contains a <em>weight</em> variable for each respondent, reflecting how much that type of respondent is overrepresented in the sample compared to the population. Compare the mean age of the sample with the <em>weighted mean</em> age of the sample. What do you notice? Do the same thing for the unweighted and weighted shares of each racial group. Redo the analyses in questions 1-4 using weighted means. What conclusions, if any, change?</p></li>
</ol>
</section>
<section id="class-notes" class="level1">
<h1>Class Notes</h1>
<p>Previously, we have worked with a tidied up version of the Cooperative Election Study (CES) from 2020. To illustrate the process of <strong>data wrangling</strong>, let’s look at the steps I took to import and clean up that dataset.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://allisonhorst.shinyapps.io/dplyr-learnr/#section-welcome"><img src="img/data_wrangler.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<section id="importing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-data">Importing The Data</h3>
<p>The CES is a survey of a representative sample of 50,000+ American adults, conducted every election year by a large consortium of universities. The data going back to 2006 is available <a href="https://cces.gov.harvard.edu/">here</a>. Go to that site and download the 2020 dataset, a 180 megabyte monster called <code>CES20_Common_OUTPUT_vv.csv</code>.</p>
<p>The <code>.csv</code> extension at the end of the file means that it is a “comma separated value” file. This is a file where all of the values are separated by commas. Looks something like this:</p>
<pre><code>name, age, party
'Joe', 35, 'Bull Moose'
'Fiona', 6, 'Birthday'
'Avery', 3, 'Know Nothing'</code></pre>
<p>It’s a nice standardized way to represent datasets, and fortunately for us, the <code>read_csv()</code> function allows us to read such files into <code>R</code>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Let’s create an object called <code>ces_raw</code> from that raw dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ces_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/raw/CES20_Common_OUTPUT_vv.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This dataset has a lot of information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ces_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 61000   717</code></pre>
</div>
</div>
<p>61,000 rows and 717 columns, to be precise. The first few rows and columns look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ces_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 717
   ...1     caseid commonweight commonpostweight vvweight vvweight_post tookpost
  &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;
1     1 1232318697        0.783            0.666    0.851         0.607        2
2     2 1231394915        1.34             1.44    NA            NA            2
3     3 1232451503        0.406            0.342   NA            NA            2
4     4 1232494791        0.958            0.822    1.04          1.00         2
5     5 1232494829        0.195            0.162   NA            NA            2
6     6 1232473675        1.06             0.880    1.15          0.988        2
# ℹ 710 more variables: CCEStake &lt;dbl&gt;, birthyr &lt;dbl&gt;, gender &lt;dbl&gt;,
#   educ &lt;dbl&gt;, race &lt;dbl&gt;, race_other &lt;chr&gt;, hispanic &lt;dbl&gt;,
#   CC20_hisp_1 &lt;dbl&gt;, CC20_hisp_2 &lt;dbl&gt;, CC20_hisp_3 &lt;dbl&gt;, CC20_hisp_4 &lt;dbl&gt;,
#   CC20_hisp_5 &lt;dbl&gt;, CC20_hisp_6 &lt;dbl&gt;, CC20_hisp_7 &lt;dbl&gt;, CC20_hisp_8 &lt;dbl&gt;,
#   CC20_hisp_9 &lt;dbl&gt;, CC20_hisp_10 &lt;dbl&gt;, CC20_hisp_11 &lt;dbl&gt;,
#   CC20_hisp_12 &lt;dbl&gt;, CC20_hisp_t &lt;chr&gt;, CC20_asian_1 &lt;dbl&gt;,
#   CC20_asian_2 &lt;dbl&gt;, CC20_asian_3 &lt;dbl&gt;, CC20_asian_4 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="recoding-variables" class="level3">
<h3 class="anchored" data-anchor-id="recoding-variables">Recoding Variables</h3>
<p>Now that we have the dataset loaded into memory, let’s find the variables we’re interested in keeping and clean them up a bit. For example, gender is coded as a 1 or 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ces_raw <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  gender     n
   &lt;dbl&gt; &lt;int&gt;
1      1 25791
2      2 35209</code></pre>
</div>
</div>
<p>Let’s make this more readable. The codebook (available at the same site where you downloaded the data) says that 1 is male and 2 is female. We can create a new version of the gender column using the <code>mutate()</code> and <code>if_else()</code> functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="ot">&lt;-</span> ces_raw <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="dv">1</span>, <span class="st">'Male'</span>, <span class="st">'Female'</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  gender     n
  &lt;chr&gt;  &lt;int&gt;
1 Female 35209
2 Male   25791</code></pre>
</div>
</div>
<p>What about the education variable (<code>educ</code>)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(educ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
   educ     n
  &lt;dbl&gt; &lt;int&gt;
1     1  1983
2     2 16618
3     3 13330
4     4  6539
5     5 14152
6     6  8378</code></pre>
</div>
</div>
<p>That’s a lot of categories to clean up. We can combine the <code>mutate()</code> function with <code>case_when()</code> to recode a bunch of different values at the same time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="ot">&lt;-</span> ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">case_when</span>(educ <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'No HS'</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                          educ <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">'High school graduate'</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                          educ <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">'Some college'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                          educ <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">'2-year'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                          educ <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">'4-year'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                          educ <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">'Post-grad'</span>))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(educ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  educ                     n
  &lt;chr&gt;                &lt;int&gt;
1 2-year                6539
2 4-year               14152
3 High school graduate 16618
4 No HS                 1983
5 Post-grad             8378
6 Some college         13330</code></pre>
</div>
</div>
<p>Now the variable has the correct labels, but notice that the order in that table is kind of weird. We tend to think of education as an <strong>ordinal</strong> variable, because there’s a natural order from least to most educated. But <code>R</code> doesn’t know that yet. It just thinks of <code>educ</code> as a character variable, and lists them in alphabetical order. We can tell <code>R</code> about the variable order by recoding <code>educ</code> as a <strong>factor</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="ot">&lt;-</span> ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">factor</span>(educ,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'No HS'</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'High school graduate'</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'Some college'</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'2-year'</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'4-year'</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'Post-grad'</span>)))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(educ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  educ                     n
  &lt;fct&gt;                &lt;int&gt;
1 No HS                 1983
2 High school graduate 16618
3 Some college         13330
4 2-year                6539
5 4-year               14152
6 Post-grad             8378</code></pre>
</div>
</div>
<p>Much better!</p>
<p>There’s a variable in CES called <code>birthyr</code>. What if we wanted to know the respondents age in 2020 instead? The <code>mutate()</code> function can help us here too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(birthyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 78 × 2
   birthyr     n
     &lt;dbl&gt; &lt;int&gt;
 1    1925     2
 2    1926     6
 3    1927    10
 4    1928    12
 5    1929    23
 6    1930    23
 7    1931    42
 8    1932    55
 9    1933    76
10    1934   109
# ℹ 68 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="ot">&lt;-</span> ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="dv">2020</span> <span class="sc">-</span> birthyr)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(birthyr, age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 78 × 3
   birthyr   age     n
     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1    1925    95     2
 2    1926    94     6
 3    1927    93    10
 4    1928    92    12
 5    1929    91    23
 6    1930    90    23
 7    1931    89    42
 8    1932    88    55
 9    1933    87    76
10    1934    86   109
# ℹ 68 more rows</code></pre>
</div>
</div>
</section>
<section id="joining-datasets" class="level3">
<h3 class="anchored" data-anchor-id="joining-datasets">Joining Datasets</h3>
<p>Here’s another messy feature of this dataset. Every respondent has a variable called <code>inputstate</code>, representing the state where they live.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inputstate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 × 2
   inputstate     n
        &lt;dbl&gt; &lt;int&gt;
 1          1   947
 2          2   115
 3          4  1463
 4          5   536
 5          6  5035
 6          8  1061
 7          9   642
 8         10   240
 9         11   197
10         12  4615
# ℹ 41 more rows</code></pre>
</div>
</div>
<p>But it’s a number! Not, like, the actual name of the state, which would be more useful to me. I don’t know all 51 state <a href="https://www.nrcs.usda.gov/wps/portal/nrcs/detail/?cid=nrcs143_013696">FIPS codes</a> by heart, but fortunately I have a dataset that includes every state’s name and FIPS code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>state_fips <span class="ot">&lt;-</span> tidycensus<span class="sc">::</span>fips_codes <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inputstate =</span> <span class="fu">as.numeric</span>(state_code)) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(inputstate, state_name) <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(state_fips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    inputstate state_name
1            1    Alabama
68           2     Alaska
97           4    Arizona
112          5   Arkansas
187          6 California
245          8   Colorado</code></pre>
</div>
</div>
<p>And I can <strong>join</strong> that information with the CES data like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="ot">&lt;-</span> ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(state_fips, <span class="at">by =</span> <span class="st">'inputstate'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inputstate, state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 × 3
   inputstate state_name               n
        &lt;dbl&gt; &lt;chr&gt;                &lt;int&gt;
 1          1 Alabama                947
 2          2 Alaska                 115
 3          4 Arizona               1463
 4          5 Arkansas               536
 5          6 California            5035
 6          8 Colorado              1061
 7          9 Connecticut            642
 8         10 Delaware               240
 9         11 District of Columbia   197
10         12 Florida               4615
# ℹ 41 more rows</code></pre>
</div>
</div>
<p>We will explore joining datasets more deeply in two weeks.</p>
</section>
<section id="selecting-variables" class="level3">
<h3 class="anchored" data-anchor-id="selecting-variables">Selecting Variables</h3>
<p>Finally, we can use the <code>select()</code> function to keep only the columns we want, and drop the columns we don’t want.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ces_clean <span class="ot">&lt;-</span> ces_clean <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(caseid, gender, educ, age, state_name)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ces_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
      caseid gender educ           age state_name   
       &lt;dbl&gt; &lt;chr&gt;  &lt;fct&gt;        &lt;dbl&gt; &lt;chr&gt;        
1 1232318697 Male   2-year          54 Connecticut  
2 1231394915 Female Post-grad       65 Florida      
3 1232451503 Female 4-year          74 Iowa         
4 1232494791 Female 4-year          58 Massachusetts
5 1232494829 Male   4-year          53 Illinois     
6 1232473675 Male   Some college    59 Ohio         </code></pre>
</div>
</div>
<p>And you can save your cleaned up version of the data to an .RData file with the <code>save()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(ces_clean, <span class="at">file =</span> <span class="st">'data/ces-clean.RData'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="additional-resources" class="level1">
<h1>Additional Resources</h1>
<ul>
<li><a href="https://allisonhorst.shinyapps.io/dplyr-learnr/#section-welcome">Wrangling Penguins</a>, by Allison Horst</li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I will generally use <code>read_csv()</code> instead of <code>read.csv()</code> in my own work, since it is faster and will give you useful error messages if the input is formatted in a way it doesn’t expect.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>