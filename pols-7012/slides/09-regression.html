<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 9: Closing Back Door Paths</title>
    <meta charset="utf-8" />
    <script src="09-regression_files/header-attrs-2.7/header-attrs.js"></script>
    <link href="09-regression_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="09-regression_files/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <script src="09-regression_files/htmlwidgets-1.5.2/htmlwidgets.js"></script>
    <script src="09-regression_files/plotly-binding-4.9.2.1/plotly.js"></script>
    <script src="09-regression_files/typedarray-0.1/typedarray.min.js"></script>
    <script src="09-regression_files/jquery-1.11.3/jquery.min.js"></script>
    <link href="09-regression_files/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
    <script src="09-regression_files/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
    <link href="09-regression_files/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="09-regression_files/plotly-main-1.52.2/plotly-latest.min.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Week 9: Closing Back Door Paths
## Linear Regression

---





## Road Map

--

### Weeks 1-6: Exploration 

- Working with data
- Visualization
- Summary Statistics

--

### Weeks 7-10: Causality 

- Linear model 
- Causal diagrams
- **Closing back door paths**
- Finding front door paths

--

### Weeks 11+: Uncertainty 

- Sampling distributions
- Confidence intervals
- Hypothesis testing

---

## Causal Inference

&lt;br&gt;

Broadly speaking, there are two ways you can make credible causal claims:

1. Close all the back door paths between your treatment and outcome. 

2. Find a *front door path*.

--

This week, we tackle number 1. Next week, number 2.


---

class: center, middle

## Does democracy reduce political corruption?


???

This will be our motivating research question over the next few weeks.


---

## Let's Play With This Dataset




```r
d &lt;- read_csv('data/week-09/corruption-data.csv')
```

If you'd like more practice with data wrangling, check out the script I use to put it this dataset together, `R/week-09/cleanup-data.R`. 

---

## Look At The Data


```r
ggplot(data = d,
       mapping = aes(x=democracy, y=cpi_score)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE)
```

&lt;img src="09-regression_files/figure-html/unnamed-chunk-3-1.png" width="500px" style="display: block; margin: auto;" /&gt;

---

## Look At The Data

Notice a neat trick I employed here. If `democracy` is a 0-1 variable, then the slope of the linear model gives you the difference in means between the two groups.

&lt;img src="09-regression_files/figure-html/unnamed-chunk-4-1.png" width="500px" style="display: block; margin: auto;" /&gt;

(Actually, you proved this in your calculus problem set. The value that minimizes the sum of squared errors is the mean.)

---

## Fit A Linear Model

The difference in corruption score between democracies and autocracies -- without conditioning on anything -- is:


```r
lm(cpi_score ~ democracy, data = d)
```

```

Call:
lm(formula = cpi_score ~ democracy, data = d)

Coefficients:
(Intercept)    democracy  
      32.09        15.61  
```

--

The average autocracy scores 32 on the Corruption Perceptions Index. The average democracy scores about 15.6 points higher.

--

Democracies are less corrupt!

---

class: center, middle

## But wait...

---

## A Back Door Path


```r
library(dagitty)
library(ggdag)

dag &lt;- dagify(Corruption ~ Democracy + GDP, Democracy ~ GDP)

ggdag_classic(dag) + theme_dag()
```

&lt;img src="09-regression_files/figure-html/unnamed-chunk-6-1.png" width="600" style="display: block; margin: auto;" /&gt;

---

## 3D View


```{=html}
&lt;div id="htmlwidget-9f34fb475914c879e907" style="width:600px;height:360px;" class="plotly html-widget"&gt;&lt;/div&gt;
&lt;script type="application/json" data-for="htmlwidget-9f34fb475914c879e907"&gt;{"x":{"visdat":{"21e4317d1547":["function () ","plotlyVisDat"]},"cur_data":"21e4317d1547","attrs":{"21e4317d1547":{"x":[62134.0277804831,44814.3115073316,53159.1434717446,101649.074863026,56668.3156096077,72372.2427980477,70005.8885797836,61242.5475414734,57557.8846084843,124569.44515978,53378.3927789903,51663.2492066497,62495.9599403015,49930.1688846785,60398.5991105885,56257.1574745554,39976.9554816851,60257.5346309881,43593.5050635196,89818.2172549684,70089.3240378269,22515.1935903221,50996.0280839373,12355.7935697174,27002.2617508326,65297.5175082743,30516.6772624267,null,16330.8876795581,38742.5457547658,94028.5976845505,43443.5833739784,44011.2315131667,37856.3471346082,18552.7532590413,64847.6517376043,42894.4926800361,39911.8788857671,42422.2786841348,13037.681093997,7489.21150258395,21737.6499065213,41254.40458771,33002.9732949304,15656.6039478208,35170.2056620571,16132.4145175205,12444.441138884,44286.9474898875,28507.4762166219,2325.40791678753,17792.9086435426,45719.008290148,47445.2020829218,23882.3542676011,49040.3429456877,29619.6872725667,10063.6499589568,32503.789920638,14257.9624870448,10517.0670336401,33515.4325286195,20101.1150499252,31148.0007910082,null,4145.22703770579,24040.1170028702,3545.10033995315,25312.0802278685,34962.032489698,10193.4695239053,33323.2757008224,13034.1653285527,11231.5710195248,5652.15060759374,20395.4942407226,3292.54406464072,23040.2879526544,47002.5493359525,16804.425782267,52059.7233148301,2780.63775054572,3432.78130027653,13661.2802492827,2824.0924775131,2274.71973639652,6996.55692650234,7826.16767727681,3709.81127019698,27334.1839780114,28133.0886494052,16012.4457431478,11878.7183637027,15299.9872589341,2319.70737799741,27517.9384466114,13416.4366277108,19494.4062048351,13656.8370383651,17256.02044768,2770.68117187672,2321.23774758047,12334.9172683236,14648.2674019058,12019.9283559331,5443.22483894621,9164.34612258003,null,19276.8963300209,8397.02104225433,16288.8302196838,12861.8365587725,18107.7835662903,32850.8193505311,13598.2612449572,9302.38529765549,12283.8073656393,9003.36423142681,3567.99293874045,1794.31480252607,13341.2105189612,3624.02493904299,1278.69815751027,9110.55582043167,4521.47915130539,5486.15508967045,20944.0290161466,4898.0505701722,15039.8093220622,15611.6486204056,1106.61893517062,2424.33087194347,29181.3632177676,8172.72608750719,5427.05824167399,1667.300515485,19227.7155985312,2675.46157089664,1491.00369641032,5369.7074947396,13246.4617553151,6965.51137380329,5779.67576510782,4547.56376486565,2284.26573573575,4964.09138891893,986.680896715623,7308.48074451221,3803.45724026778,9019.69380356991,12937.4759795684,15195.5296771146,1719.90601296554,1338.09666600215,5362.75841748844,3529.31112569977,5981.45089204649,2961.44642810493,5646.39946843178,4583.01645053007,1649.52917196648,3194.90074820584,null,11362.6914755367,2156.41948202725,784.92698867139,3835.66258234277,2077.40166918098,null,1146.53586681718,3034.01211008755,null,15845.6599284929,19379.2424653675,4122.52668491946,null,null,null,null,null],"y":[1,1,1,0,1,1,1,1,1,1,1,1,null,1,1,1,1,null,1,1,0,1,1,1,1,1,null,1,null,null,0,1,1,1,1,null,1,1,1,null,1,1,1,1,1,1,null,null,1,0,0,null,1,null,1,0,1,1,1,1,0,1,0,1,0,null,1,1,1,1,1,1,1,1,1,null,null,1,0,0,0,1,1,1,1,1,1,0,1,1,0,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,null,0,0,null,1,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,1,0,1,1,1,0,0,1,0,0,1,0,0,1,0,1,1,1,1,0,1,0,1,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0],"z":[88,88,85,85,85,85,84,82,80,80,77,77,77,77,76,76,75,75,74,72,71,71,69,68,67,67,66,65,64,63,63,62,61,61,60,60,60,60,60,59,58,57,57,57,56,56,56,55,54,54,54,53,53,53,53,53,51,51,50,49,49,49,47,47,47,47,45,45,44,44,44,44,44,44,43,43,43,42,42,42,42,42,41,41,41,40,40,40,40,40,40,39,39,38,38,38,38,38,38,38,38,37,37,36,36,36,36,36,36,36,35,35,35,35,34,34,33,33,33,33,33,33,32,31,31,31,31,31,30,30,30,30,30,29,29,29,28,28,28,28,28,27,27,27,27,26,26,26,25,25,25,25,25,25,25,25,24,24,22,21,21,21,21,21,19,19,19,19,19,18,18,18,17,16,16,15,15,14,12,12],"mode":"markers","marker":{"size":5,"color":"black","symbol":104},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"GDP Per Capita"},"yaxis":{"title":"Democracy"},"zaxis":{"title":"Corruption Perceptions"}},"hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[62134.0277804831,44814.3115073316,53159.1434717446,101649.074863026,56668.3156096077,72372.2427980477,70005.8885797836,61242.5475414734,57557.8846084843,124569.44515978,53378.3927789903,51663.2492066497,49930.1688846785,60398.5991105885,56257.1574745554,39976.9554816851,43593.5050635196,89818.2172549684,70089.3240378269,22515.1935903221,50996.0280839373,12355.7935697174,27002.2617508326,65297.5175082743,94028.5976845505,43443.5833739784,44011.2315131667,37856.3471346082,18552.7532590413,42894.4926800361,39911.8788857671,42422.2786841348,7489.21150258395,21737.6499065213,41254.40458771,33002.9732949304,15656.6039478208,35170.2056620571,44286.9474898875,28507.4762166219,2325.40791678753,45719.008290148,23882.3542676011,49040.3429456877,29619.6872725667,10063.6499589568,32503.789920638,14257.9624870448,10517.0670336401,33515.4325286195,20101.1150499252,31148.0007910082,24040.1170028702,3545.10033995315,25312.0802278685,34962.032489698,10193.4695239053,33323.2757008224,13034.1653285527,11231.5710195248,5652.15060759374,23040.2879526544,47002.5493359525,16804.425782267,52059.7233148301,2780.63775054572,3432.78130027653,13661.2802492827,2824.0924775131,2274.71973639652,6996.55692650234,7826.16767727681,3709.81127019698,27334.1839780114,28133.0886494052,16012.4457431478,11878.7183637027,15299.9872589341,2319.70737799741,27517.9384466114,13416.4366277108,19494.4062048351,13656.8370383651,17256.02044768,2770.68117187672,2321.23774758047,12334.9172683236,14648.2674019058,12019.9283559331,5443.22483894621,9164.34612258003,19276.8963300209,8397.02104225433,12861.8365587725,18107.7835662903,32850.8193505311,13598.2612449572,9302.38529765549,12283.8073656393,9003.36423142681,3567.99293874045,1794.31480252607,13341.2105189612,3624.02493904299,1278.69815751027,9110.55582043167,4521.47915130539,5486.15508967045,20944.0290161466,4898.0505701722,15039.8093220622,15611.6486204056,1106.61893517062,2424.33087194347,29181.3632177676,8172.72608750719,5427.05824167399,1667.300515485,19227.7155985312,2675.46157089664,1491.00369641032,5369.7074947396,13246.4617553151,6965.51137380329,5779.67576510782,4547.56376486565,2284.26573573575,4964.09138891893,986.680896715623,7308.48074451221,3803.45724026778,9019.69380356991,12937.4759795684,15195.5296771146,1719.90601296554,1338.09666600215,5362.75841748844,3529.31112569977,5981.45089204649,2961.44642810493,5646.39946843178,4583.01645053007,1649.52917196648,3194.90074820584,11362.6914755367,2156.41948202725,784.92698867139,3835.66258234277,2077.40166918098,1146.53586681718,3034.01211008755,15845.6599284929,19379.2424653675,4122.52668491946],"y":[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,1,1,0,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,1,0,1,1,1,0,0,1,0,0,1,0,0,1,0,1,1,1,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0],"z":[88,88,85,85,85,85,84,82,80,80,77,77,77,76,76,75,74,72,71,71,69,68,67,67,63,62,61,61,60,60,60,60,58,57,57,57,56,56,54,54,54,53,53,53,51,51,50,49,49,49,47,47,45,45,44,44,44,44,44,44,43,42,42,42,42,42,41,41,41,40,40,40,40,40,40,39,39,38,38,38,38,38,38,38,38,37,37,36,36,36,36,36,36,35,35,35,34,34,33,33,33,33,33,33,32,31,31,31,31,31,30,30,30,30,30,29,29,29,28,28,28,28,28,27,27,27,27,26,26,26,25,25,25,25,25,25,25,25,24,24,22,21,21,21,21,19,19,19,19,18,18,17,16,16],"mode":"markers","marker":{"color":"black","size":5,"symbol":104,"line":{"color":"rgba(31,119,180,1)"}},"type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}&lt;/script&gt;
```

---

## How Do You Condition On A Continuous Variable?

--

Every country has its own unique GDP per capita! If you tried to just isolate the countries with national income of, say, $2,770 per person, it would...just be Tanzania. Can't do a statistical comparison with a sample size of 1.

---

## How Do You Condition On A Continuous Variable?

You could try something like this...


```r
d %&gt;% 
  mutate(income_group = case_when(gdp_per_capita &lt; 10000 ~ 'Low Income',
                                  gdp_per_capita &lt; 40000 ~ 'Middle Income',
                                  TRUE ~ 'High Income')) %&gt;% 
  ggplot(mapping = aes(x=democracy, y=cpi_score)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE) +
  facet_wrap(~income_group)
```

---

## How Do You Condition On A Continuous Variable?

You could try something like this...

&lt;img src="09-regression_files/figure-html/unnamed-chunk-8-1.png" width="700px" style="display: block; margin: auto;" /&gt;

--

But there's still a lot of variation in GDP within each of those subplots. We haven't completely conditioned on GDP -- so the back door path is still open!

---

## How Do You Condition On A Continuous Variable?

**Our Approach**: Add more variables to the linear model, drawing a "plane of best fit".


```{=html}
&lt;div id="htmlwidget-007b0139bc4ca8d71607" style="width:600px;height:360px;" class="plotly html-widget"&gt;&lt;/div&gt;
&lt;script type="application/json" data-for="htmlwidget-007b0139bc4ca8d71607"&gt;{"x":{"visdat":{"21e412783ff8":["function () ","plotlyVisDat"]},"cur_data":"21e412783ff8","attrs":{"21e412783ff8":{"z":[[23.6729453577259,27.7625927861867,31.8522402146474,35.9418876431082,40.0315350715689,44.1211825000297,48.2108299284904,52.3004773569512,56.3901247854119,60.4797722138727,64.5694196423335,68.6590670707942,72.748714499255,76.8383619277157,80.9280093561765,85.0176567846372,89.107304213098,93.1969516415587,97.2865990700195,101.37624649848],[24.1399648469166,28.2296122753774,32.3192597038381,36.4089071322989,40.4985545607596,44.5882019892204,48.6778494176812,52.7674968461419,56.8571442746027,60.9467917030634,65.0364391315242,69.1260865599849,73.2157339884457,77.3053814169064,81.3950288453672,85.484676273828,89.5743237022887,93.6639711307495,97.7536185592102,101.843265987671],[24.6069843361073,28.6966317645681,32.7862791930289,36.8759266214896,40.9655740499504,45.0552214784111,49.1448689068719,53.2345163353326,57.3241637637934,61.4138111922541,65.5034586207149,69.5931060491756,73.6827534776364,77.7724009060972,81.8620483345579,85.9516957630187,90.0413431914794,94.1309906199402,98.2206380484009,102.310285476862],[25.0740038252981,29.1636512537588,33.2532986822196,37.3429461106803,41.4325935391411,45.5222409676018,49.6118883960626,53.7015358245233,57.7911832529841,61.8808306814449,65.9704781099056,70.0601255383664,74.1497729668271,78.2394203952879,82.3290678237486,86.4187152522094,90.5083626806702,94.5980101091309,98.6876575375917,102.777304966052],[25.5410233144888,29.6306707429495,33.7203181714103,37.809965599871,41.8996130283318,45.9892604567926,50.0789078852533,54.1685553137141,58.2582027421748,62.3478501706356,66.4374975990963,70.5271450275571,74.6167924560178,78.7064398844786,82.7960873129394,86.8857347414001,90.9753821698609,95.0650295983216,99.1546770267824,103.244324455243],[26.0080428036795,30.0976902321403,34.187337660601,38.2769850890618,42.3666325175225,46.4562799459833,50.545927374444,54.6355748029048,58.7252222313656,62.8148696598263,66.9045170882871,70.9941645167478,75.0838119452086,79.1734593736693,83.2631068021301,87.3527542305908,91.4424016590516,95.5320490875123,99.6216965159731,103.711343944434],[26.4750622928702,30.564709721331,34.6543571497917,38.7440045782525,42.8336520067133,46.923299435174,51.0129468636348,55.1025942920955,59.1922417205563,63.281889149017,67.3715365774778,71.4611840059385,75.5508314343993,79.64047886286,83.7301262913208,87.8197737197816,91.9094211482423,95.9990685767031,100.088716005164,104.178363433625],[26.942081782061,31.0317292105217,35.1213766389825,39.2110240674432,43.300671495904,47.3903189243647,51.4799663528255,55.5696137812862,59.659261209747,63.7489086382078,67.8385560666685,71.9282034951293,76.01785092359,80.1074983520508,84.1971457805115,88.2867932089723,92.376440637433,96.4660880658938,100.555735494355,104.645382922815],[27.4091012712517,31.4987486997124,35.5883961281732,39.6780435566339,43.7676909850947,47.8573384135555,51.9469858420162,56.036633270477,60.1262806989377,64.2159281273985,68.3055755558592,72.39522298432,76.4848704127807,80.5745178412415,84.6641652697022,88.753812698163,92.8434601266238,96.9331075550845,101.022754983545,105.112402412006],[27.8761207604424,31.9657681889032,36.0554156173639,40.1450630458247,44.2347104742854,48.3243579027462,52.4140053312069,56.5036527596677,60.5933001881284,64.6829476165892,68.77259504505,72.8622424735107,76.9518899019715,81.0415373304322,85.131184758893,89.2208321873537,93.3104796158145,97.4001270442753,101.489774472736,105.579421901197],[28.3431402496331,32.4327876780939,36.5224351065546,40.6120825350154,44.7017299634761,48.7913773919369,52.8810248203976,56.9706722488584,61.0603196773192,65.1499671057799,69.2396145342407,73.3292619627014,77.4189093911622,81.5085568196229,85.5982042480837,89.6878516765445,93.7774991050052,97.867146533466,101.956793961927,106.046441390387],[28.8101597388238,32.8998071672846,36.9894545957454,41.0791020242061,45.1687494526669,49.2583968811276,53.3480443095884,57.4376917380491,61.5273391665099,65.6169865949706,69.7066340234314,73.7962814518922,77.8859288803529,81.9755763088137,86.0652237372744,90.1548711657352,94.2445185941959,98.3341660226567,102.423813451117,106.513460879578],[29.2771792280146,33.3668266564753,37.4564740849361,41.5461215133968,45.6357689418576,49.7254163703183,53.8150637987791,57.9047112272398,61.9943586557006,66.0840060841614,70.1736535126221,74.2633009410829,78.3529483695436,82.4425957980044,86.5322432264651,90.6218906549259,94.7115380833867,98.8011855118474,102.890832940308,106.980480368769],[29.7441987172053,33.833846145666,37.9234935741268,42.0131410025875,46.1027884310483,50.1924358595091,54.2820832879698,58.3717307164306,62.4613781448913,66.5510255733521,70.6406730018128,74.7303204302736,78.8199678587343,82.9096152871951,86.9992627156559,91.0889101441166,95.1785575725774,99.2682050010381,103.357852429499,107.44749985796],[30.211218206396,34.3008656348568,38.3905130633175,42.4801604917783,46.569807920239,50.6594553486998,54.7491027771605,58.8387502056213,62.9283976340821,67.0180450625428,71.1076924910036,75.1973399194643,79.2869873479251,83.3766347763858,87.4662822048466,91.5559296333073,95.6455770617681,99.7352244902289,103.82487191869,107.91451934715],[30.6782376955867,34.7678851240475,38.8575325525082,42.947179980969,47.0368274094297,51.1264748378905,55.2161222663513,59.305769694812,63.3954171232728,67.4850645517335,71.5747119801943,75.664359408655,79.7540068371158,83.8436542655765,87.9333016940373,92.0229491224981,96.1125965509588,100.20224397942,104.29189140788,108.381538836341],[31.1452571847774,35.2349046132382,39.324552041699,43.4141994701597,47.5038468986205,51.5934943270812,55.683141755542,59.7727891840027,63.8624366124635,67.9520840409242,72.041731469385,76.1313788978458,80.2210263263065,84.3106737547673,88.400321183228,92.4899686116888,96.5796160401495,100.66926346861,104.758910897071,108.848558325532],[31.6122766739682,35.7019241024289,39.7915715308897,43.8812189593504,47.9708663878112,52.0605138162719,56.1501612447327,60.2398086731935,64.3294561016542,68.419103530115,72.5087509585757,76.5983983870365,80.6880458154972,84.777693243958,88.8673406724187,92.9569881008795,97.0466355293403,101.136282957801,105.225930386262,109.315577814723],[32.0792961631589,36.1689435916197,40.2585910200804,44.3482384485412,48.4378858770019,52.5275333054627,56.6171807339234,60.7068281623842,64.7964755908449,68.8861230193057,72.9757704477665,77.0654178762272,81.155065304688,85.2447127331487,89.3343601616095,93.4240075900702,97.513655018531,101.603302446992,105.692949875452,109.782597303913],[32.5463156523496,36.6359630808104,40.7256105092711,44.8152579377319,48.9049053661926,52.9945527946534,57.0842002231142,61.1738476515749,65.2634950800357,69.3531425084964,73.4427899369572,77.5324373654179,81.6220847938787,85.7117322223394,89.8013796508002,93.891027079261,97.9806745077217,102.070321936182,106.159969364643,110.249616793104]],"x":[0,0.0526315789473684,0.105263157894737,0.157894736842105,0.210526315789474,0.263157894736842,0.315789473684211,0.368421052631579,0.421052631578947,0.473684210526316,0.526315789473684,0.578947368421053,0.631578947368421,0.684210526315789,0.736842105263158,0.789473684210526,0.842105263157895,0.894736842105263,0.947368421052632,1],"y":[0,6556.28658735684,13112.5731747137,19668.8597620705,26225.1463494274,32781.4329367842,39337.7195241411,45894.0061114979,52450.2926988547,59006.5792862116,65562.8658735684,72119.1524609253,78675.4390482821,85231.725635639,91788.0122229958,98344.2988103526,104900.585397709,111456.871985066,118013.158572423,124569.44515978],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface"},"21e412783ff8.1":{"z":[88,88,85,85,85,85,84,82,80,80,77,77,77,77,76,76,75,75,74,72,71,71,69,68,67,67,66,65,64,63,63,62,61,61,60,60,60,60,60,59,58,57,57,57,56,56,56,55,54,54,54,53,53,53,53,53,51,51,50,49,49,49,47,47,47,47,45,45,44,44,44,44,44,44,43,43,43,42,42,42,42,42,41,41,41,40,40,40,40,40,40,39,39,38,38,38,38,38,38,38,38,37,37,36,36,36,36,36,36,36,35,35,35,35,34,34,33,33,33,33,33,33,32,31,31,31,31,31,30,30,30,30,30,29,29,29,28,28,28,28,28,27,27,27,27,26,26,26,25,25,25,25,25,25,25,25,24,24,22,21,21,21,21,21,19,19,19,19,19,18,18,18,17,16,16,15,15,14,12,12],"x":[1,1,1,0,1,1,1,1,1,1,1,1,null,1,1,1,1,null,1,1,0,1,1,1,1,1,null,1,null,null,0,1,1,1,1,null,1,1,1,null,1,1,1,1,1,1,null,null,1,0,0,null,1,null,1,0,1,1,1,1,0,1,0,1,0,null,1,1,1,1,1,1,1,1,1,null,null,1,0,0,0,1,1,1,1,1,1,0,1,1,0,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,null,0,0,null,1,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,1,0,1,1,1,0,0,1,0,0,1,0,0,1,0,1,1,1,1,0,1,0,1,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0],"y":[62134.0277804831,44814.3115073316,53159.1434717446,101649.074863026,56668.3156096077,72372.2427980477,70005.8885797836,61242.5475414734,57557.8846084843,124569.44515978,53378.3927789903,51663.2492066497,62495.9599403015,49930.1688846785,60398.5991105885,56257.1574745554,39976.9554816851,60257.5346309881,43593.5050635196,89818.2172549684,70089.3240378269,22515.1935903221,50996.0280839373,12355.7935697174,27002.2617508326,65297.5175082743,30516.6772624267,null,16330.8876795581,38742.5457547658,94028.5976845505,43443.5833739784,44011.2315131667,37856.3471346082,18552.7532590413,64847.6517376043,42894.4926800361,39911.8788857671,42422.2786841348,13037.681093997,7489.21150258395,21737.6499065213,41254.40458771,33002.9732949304,15656.6039478208,35170.2056620571,16132.4145175205,12444.441138884,44286.9474898875,28507.4762166219,2325.40791678753,17792.9086435426,45719.008290148,47445.2020829218,23882.3542676011,49040.3429456877,29619.6872725667,10063.6499589568,32503.789920638,14257.9624870448,10517.0670336401,33515.4325286195,20101.1150499252,31148.0007910082,null,4145.22703770579,24040.1170028702,3545.10033995315,25312.0802278685,34962.032489698,10193.4695239053,33323.2757008224,13034.1653285527,11231.5710195248,5652.15060759374,20395.4942407226,3292.54406464072,23040.2879526544,47002.5493359525,16804.425782267,52059.7233148301,2780.63775054572,3432.78130027653,13661.2802492827,2824.0924775131,2274.71973639652,6996.55692650234,7826.16767727681,3709.81127019698,27334.1839780114,28133.0886494052,16012.4457431478,11878.7183637027,15299.9872589341,2319.70737799741,27517.9384466114,13416.4366277108,19494.4062048351,13656.8370383651,17256.02044768,2770.68117187672,2321.23774758047,12334.9172683236,14648.2674019058,12019.9283559331,5443.22483894621,9164.34612258003,null,19276.8963300209,8397.02104225433,16288.8302196838,12861.8365587725,18107.7835662903,32850.8193505311,13598.2612449572,9302.38529765549,12283.8073656393,9003.36423142681,3567.99293874045,1794.31480252607,13341.2105189612,3624.02493904299,1278.69815751027,9110.55582043167,4521.47915130539,5486.15508967045,20944.0290161466,4898.0505701722,15039.8093220622,15611.6486204056,1106.61893517062,2424.33087194347,29181.3632177676,8172.72608750719,5427.05824167399,1667.300515485,19227.7155985312,2675.46157089664,1491.00369641032,5369.7074947396,13246.4617553151,6965.51137380329,5779.67576510782,4547.56376486565,2284.26573573575,4964.09138891893,986.680896715623,7308.48074451221,3803.45724026778,9019.69380356991,12937.4759795684,15195.5296771146,1719.90601296554,1338.09666600215,5362.75841748844,3529.31112569977,5981.45089204649,2961.44642810493,5646.39946843178,4583.01645053007,1649.52917196648,3194.90074820584,null,11362.6914755367,2156.41948202725,784.92698867139,3835.66258234277,2077.40166918098,null,1146.53586681718,3034.01211008755,null,15845.6599284929,19379.2424653675,4122.52668491946,null,null,null,null,null],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d","mode":"markers","marker":{"size":5,"color":"black","symbol":104},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Democracy"},"yaxis":{"title":"GDP Per Capita"},"zaxis":{"title":"Corruption Perceptions Index"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"z":[[23.6729453577259,27.7625927861867,31.8522402146474,35.9418876431082,40.0315350715689,44.1211825000297,48.2108299284904,52.3004773569512,56.3901247854119,60.4797722138727,64.5694196423335,68.6590670707942,72.748714499255,76.8383619277157,80.9280093561765,85.0176567846372,89.107304213098,93.1969516415587,97.2865990700195,101.37624649848],[24.1399648469166,28.2296122753774,32.3192597038381,36.4089071322989,40.4985545607596,44.5882019892204,48.6778494176812,52.7674968461419,56.8571442746027,60.9467917030634,65.0364391315242,69.1260865599849,73.2157339884457,77.3053814169064,81.3950288453672,85.484676273828,89.5743237022887,93.6639711307495,97.7536185592102,101.843265987671],[24.6069843361073,28.6966317645681,32.7862791930289,36.8759266214896,40.9655740499504,45.0552214784111,49.1448689068719,53.2345163353326,57.3241637637934,61.4138111922541,65.5034586207149,69.5931060491756,73.6827534776364,77.7724009060972,81.8620483345579,85.9516957630187,90.0413431914794,94.1309906199402,98.2206380484009,102.310285476862],[25.0740038252981,29.1636512537588,33.2532986822196,37.3429461106803,41.4325935391411,45.5222409676018,49.6118883960626,53.7015358245233,57.7911832529841,61.8808306814449,65.9704781099056,70.0601255383664,74.1497729668271,78.2394203952879,82.3290678237486,86.4187152522094,90.5083626806702,94.5980101091309,98.6876575375917,102.777304966052],[25.5410233144888,29.6306707429495,33.7203181714103,37.809965599871,41.8996130283318,45.9892604567926,50.0789078852533,54.1685553137141,58.2582027421748,62.3478501706356,66.4374975990963,70.5271450275571,74.6167924560178,78.7064398844786,82.7960873129394,86.8857347414001,90.9753821698609,95.0650295983216,99.1546770267824,103.244324455243],[26.0080428036795,30.0976902321403,34.187337660601,38.2769850890618,42.3666325175225,46.4562799459833,50.545927374444,54.6355748029048,58.7252222313656,62.8148696598263,66.9045170882871,70.9941645167478,75.0838119452086,79.1734593736693,83.2631068021301,87.3527542305908,91.4424016590516,95.5320490875123,99.6216965159731,103.711343944434],[26.4750622928702,30.564709721331,34.6543571497917,38.7440045782525,42.8336520067133,46.923299435174,51.0129468636348,55.1025942920955,59.1922417205563,63.281889149017,67.3715365774778,71.4611840059385,75.5508314343993,79.64047886286,83.7301262913208,87.8197737197816,91.9094211482423,95.9990685767031,100.088716005164,104.178363433625],[26.942081782061,31.0317292105217,35.1213766389825,39.2110240674432,43.300671495904,47.3903189243647,51.4799663528255,55.5696137812862,59.659261209747,63.7489086382078,67.8385560666685,71.9282034951293,76.01785092359,80.1074983520508,84.1971457805115,88.2867932089723,92.376440637433,96.4660880658938,100.555735494355,104.645382922815],[27.4091012712517,31.4987486997124,35.5883961281732,39.6780435566339,43.7676909850947,47.8573384135555,51.9469858420162,56.036633270477,60.1262806989377,64.2159281273985,68.3055755558592,72.39522298432,76.4848704127807,80.5745178412415,84.6641652697022,88.753812698163,92.8434601266238,96.9331075550845,101.022754983545,105.112402412006],[27.8761207604424,31.9657681889032,36.0554156173639,40.1450630458247,44.2347104742854,48.3243579027462,52.4140053312069,56.5036527596677,60.5933001881284,64.6829476165892,68.77259504505,72.8622424735107,76.9518899019715,81.0415373304322,85.131184758893,89.2208321873537,93.3104796158145,97.4001270442753,101.489774472736,105.579421901197],[28.3431402496331,32.4327876780939,36.5224351065546,40.6120825350154,44.7017299634761,48.7913773919369,52.8810248203976,56.9706722488584,61.0603196773192,65.1499671057799,69.2396145342407,73.3292619627014,77.4189093911622,81.5085568196229,85.5982042480837,89.6878516765445,93.7774991050052,97.867146533466,101.956793961927,106.046441390387],[28.8101597388238,32.8998071672846,36.9894545957454,41.0791020242061,45.1687494526669,49.2583968811276,53.3480443095884,57.4376917380491,61.5273391665099,65.6169865949706,69.7066340234314,73.7962814518922,77.8859288803529,81.9755763088137,86.0652237372744,90.1548711657352,94.2445185941959,98.3341660226567,102.423813451117,106.513460879578],[29.2771792280146,33.3668266564753,37.4564740849361,41.5461215133968,45.6357689418576,49.7254163703183,53.8150637987791,57.9047112272398,61.9943586557006,66.0840060841614,70.1736535126221,74.2633009410829,78.3529483695436,82.4425957980044,86.5322432264651,90.6218906549259,94.7115380833867,98.8011855118474,102.890832940308,106.980480368769],[29.7441987172053,33.833846145666,37.9234935741268,42.0131410025875,46.1027884310483,50.1924358595091,54.2820832879698,58.3717307164306,62.4613781448913,66.5510255733521,70.6406730018128,74.7303204302736,78.8199678587343,82.9096152871951,86.9992627156559,91.0889101441166,95.1785575725774,99.2682050010381,103.357852429499,107.44749985796],[30.211218206396,34.3008656348568,38.3905130633175,42.4801604917783,46.569807920239,50.6594553486998,54.7491027771605,58.8387502056213,62.9283976340821,67.0180450625428,71.1076924910036,75.1973399194643,79.2869873479251,83.3766347763858,87.4662822048466,91.5559296333073,95.6455770617681,99.7352244902289,103.82487191869,107.91451934715],[30.6782376955867,34.7678851240475,38.8575325525082,42.947179980969,47.0368274094297,51.1264748378905,55.2161222663513,59.305769694812,63.3954171232728,67.4850645517335,71.5747119801943,75.664359408655,79.7540068371158,83.8436542655765,87.9333016940373,92.0229491224981,96.1125965509588,100.20224397942,104.29189140788,108.381538836341],[31.1452571847774,35.2349046132382,39.324552041699,43.4141994701597,47.5038468986205,51.5934943270812,55.683141755542,59.7727891840027,63.8624366124635,67.9520840409242,72.041731469385,76.1313788978458,80.2210263263065,84.3106737547673,88.400321183228,92.4899686116888,96.5796160401495,100.66926346861,104.758910897071,108.848558325532],[31.6122766739682,35.7019241024289,39.7915715308897,43.8812189593504,47.9708663878112,52.0605138162719,56.1501612447327,60.2398086731935,64.3294561016542,68.419103530115,72.5087509585757,76.5983983870365,80.6880458154972,84.777693243958,88.8673406724187,92.9569881008795,97.0466355293403,101.136282957801,105.225930386262,109.315577814723],[32.0792961631589,36.1689435916197,40.2585910200804,44.3482384485412,48.4378858770019,52.5275333054627,56.6171807339234,60.7068281623842,64.7964755908449,68.8861230193057,72.9757704477665,77.0654178762272,81.155065304688,85.2447127331487,89.3343601616095,93.4240075900702,97.513655018531,101.603302446992,105.692949875452,109.782597303913],[32.5463156523496,36.6359630808104,40.7256105092711,44.8152579377319,48.9049053661926,52.9945527946534,57.0842002231142,61.1738476515749,65.2634950800357,69.3531425084964,73.4427899369572,77.5324373654179,81.6220847938787,85.7117322223394,89.8013796508002,93.891027079261,97.9806745077217,102.070321936182,106.159969364643,110.249616793104]],"x":[0,0.0526315789473684,0.105263157894737,0.157894736842105,0.210526315789474,0.263157894736842,0.315789473684211,0.368421052631579,0.421052631578947,0.473684210526316,0.526315789473684,0.578947368421053,0.631578947368421,0.684210526315789,0.736842105263158,0.789473684210526,0.842105263157895,0.894736842105263,0.947368421052632,1],"y":[0,6556.28658735684,13112.5731747137,19668.8597620705,26225.1463494274,32781.4329367842,39337.7195241411,45894.0061114979,52450.2926988547,59006.5792862116,65562.8658735684,72119.1524609253,78675.4390482821,85231.725635639,91788.0122229958,98344.2988103526,104900.585397709,111456.871985066,118013.158572423,124569.44515978],"type":"surface","frame":null},{"z":[88,88,85,85,85,85,84,82,80,80,77,77,77,76,76,75,74,72,71,71,69,68,67,67,63,62,61,61,60,60,60,60,58,57,57,57,56,56,54,54,54,53,53,53,51,51,50,49,49,49,47,47,45,45,44,44,44,44,44,44,43,42,42,42,42,42,41,41,41,40,40,40,40,40,40,39,39,38,38,38,38,38,38,38,38,37,37,36,36,36,36,36,36,35,35,35,34,34,33,33,33,33,33,33,32,31,31,31,31,31,30,30,30,30,30,29,29,29,28,28,28,28,28,27,27,27,27,26,26,26,25,25,25,25,25,25,25,25,24,24,22,21,21,21,21,19,19,19,19,18,18,17,16,16],"x":[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,1,1,0,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,1,0,1,1,1,0,0,1,0,0,1,0,0,1,0,1,1,1,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0],"y":[62134.0277804831,44814.3115073316,53159.1434717446,101649.074863026,56668.3156096077,72372.2427980477,70005.8885797836,61242.5475414734,57557.8846084843,124569.44515978,53378.3927789903,51663.2492066497,49930.1688846785,60398.5991105885,56257.1574745554,39976.9554816851,43593.5050635196,89818.2172549684,70089.3240378269,22515.1935903221,50996.0280839373,12355.7935697174,27002.2617508326,65297.5175082743,94028.5976845505,43443.5833739784,44011.2315131667,37856.3471346082,18552.7532590413,42894.4926800361,39911.8788857671,42422.2786841348,7489.21150258395,21737.6499065213,41254.40458771,33002.9732949304,15656.6039478208,35170.2056620571,44286.9474898875,28507.4762166219,2325.40791678753,45719.008290148,23882.3542676011,49040.3429456877,29619.6872725667,10063.6499589568,32503.789920638,14257.9624870448,10517.0670336401,33515.4325286195,20101.1150499252,31148.0007910082,24040.1170028702,3545.10033995315,25312.0802278685,34962.032489698,10193.4695239053,33323.2757008224,13034.1653285527,11231.5710195248,5652.15060759374,23040.2879526544,47002.5493359525,16804.425782267,52059.7233148301,2780.63775054572,3432.78130027653,13661.2802492827,2824.0924775131,2274.71973639652,6996.55692650234,7826.16767727681,3709.81127019698,27334.1839780114,28133.0886494052,16012.4457431478,11878.7183637027,15299.9872589341,2319.70737799741,27517.9384466114,13416.4366277108,19494.4062048351,13656.8370383651,17256.02044768,2770.68117187672,2321.23774758047,12334.9172683236,14648.2674019058,12019.9283559331,5443.22483894621,9164.34612258003,19276.8963300209,8397.02104225433,12861.8365587725,18107.7835662903,32850.8193505311,13598.2612449572,9302.38529765549,12283.8073656393,9003.36423142681,3567.99293874045,1794.31480252607,13341.2105189612,3624.02493904299,1278.69815751027,9110.55582043167,4521.47915130539,5486.15508967045,20944.0290161466,4898.0505701722,15039.8093220622,15611.6486204056,1106.61893517062,2424.33087194347,29181.3632177676,8172.72608750719,5427.05824167399,1667.300515485,19227.7155985312,2675.46157089664,1491.00369641032,5369.7074947396,13246.4617553151,6965.51137380329,5779.67576510782,4547.56376486565,2284.26573573575,4964.09138891893,986.680896715623,7308.48074451221,3803.45724026778,9019.69380356991,12937.4759795684,15195.5296771146,1719.90601296554,1338.09666600215,5362.75841748844,3529.31112569977,5981.45089204649,2961.44642810493,5646.39946843178,4583.01645053007,1649.52917196648,3194.90074820584,11362.6914755367,2156.41948202725,784.92698867139,3835.66258234277,2077.40166918098,1146.53586681718,3034.01211008755,15845.6599284929,19379.2424653675,4122.52668491946],"type":"scatter3d","mode":"markers","marker":{"color":"black","size":5,"symbol":104,"line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}&lt;/script&gt;
```


---

class: center, middle

## What's Going On Under The Hood

---

## Multivariable Linear Regression

The "plane of best fit" is described by a linear model with multiple `\(X\)` variables on the right hand side.

--

`$$\text{corruption} = \alpha + \beta_1 \text{democracy} + \beta_2 \text{GDP} + \varepsilon$$`
This model says: "Corruption probably depends on both democracy **and** national income. Richer, democratic countries will tend to have less corruption." We'd like to estimate the slope of both relationships simultaneously!

--

**Vector Representation**:

`$$\underbrace{\begin{bmatrix} 19 \\ 36 \\ 36 \\ \vdots \\ 24 \end{bmatrix}}_\text{corruption} = \underbrace{\alpha \times \begin{bmatrix} 1 \\ 1 \\1 \\ \vdots \\ 1 \end{bmatrix}}_\alpha + \underbrace{\beta_1 \times \begin{bmatrix} 0 \\ 1 \\ 0 \\ \vdots \\ 0 \end{bmatrix}}_{\beta_1 \text{democracy}} + \underbrace{\beta_2 \times \begin{bmatrix} 2,156 \\ 14,648 \\ 12,019 \\ \vdots \\ 2,961 \end{bmatrix}}_{\beta_2 \text{GDP}} +  \underbrace{\begin{bmatrix} \varepsilon_1 \\ \varepsilon_2 \\ \varepsilon_3 \\ \vdots \\ \varepsilon_n \end{bmatrix}}_\varepsilon$$`
---

## Multivariable Linear Regression

The challenge is to simultaneously estimate `\(\alpha\)`, `\(\beta_1\)`, and `\(\beta_2\)`.

`$$\text{corruption} = \alpha + \beta_1 \text{democracy} + \beta_2 \text{GDP} + \varepsilon$$`
--

We've come as far as we can with scalar algebra. It's time you learned **matrix algebra**.

---

class: center, middle

# Matrix Algebra

---

## Matrix Algebra

A **matrix** is a bunch of vectors squished together.

--

.pull-left[
`\(\text{democracy} = \begin{bmatrix} 0 \\ 1 \\ 0 \\ \vdots \\ 0  \end{bmatrix}\)`
]

.pull-right[
`\(\text{GDP} = \begin{bmatrix} 2,156 \\ 14,648 \\ 12,019 \\ \vdots \\ 2,961 \end{bmatrix}\)`
]

--

&lt;br&gt;

`$$X = \begin{bmatrix} 0 &amp; 2,156 \\ 1 &amp; 14,648 \\ 0 &amp; 12,019 \\ \vdots &amp; \vdots \\ 0 &amp; 2,961 \end{bmatrix}$$`
--

We've been calling this a **dataframe**.

---

## Matrix Algebra

The **dimension** of a matrix refers to the number of rows and columns. An `\(m \times n\)` matrix has `\(m\)` rows and `\(n\)` columns.

--


```r
dim(d)
```

```
[1] 180   6
```

There are 180 rows and 6 columns in the corruption dataset.

---

## Matrix Algebra

**Adding** and **subtracting** matrices is straightforward. Just add and subtract elementwise. 

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \\ 4 &amp; 4 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \\ 8 &amp; 5 \end{bmatrix}\)`
]

--

`$$A + B = \begin{bmatrix} 3 &amp; 3 \\ 6 &amp; 7 \\ 12 &amp; 9 \end{bmatrix}$$`
--

**Multiplying** and **dividing** is where it gets tricky.
  - You can only multiply *some* matrices together (they must be **conformable**)
  - And matrix division isn't really a thing. Instead, we multiply by the matrix's **inverse**.


---

class: center, middle

## Matrix Multiplication

---

## Matrix Multiplication

--

First, let's introduce the **dot product** of two vectors.

`$$a \cdot b = \sum a_i b_i$$`
--

If `\(a = [3,1,2]\)` and `\(b = [1,2,3]\)`, then the dot product of `\(a\)` and `\(b\)` equals:

`$$a \cdot b =  3 \times 1 + 1 \times 2 + 2 \times 3 = 11$$`
--

In `R`, a dot product can be computed like so:


```r
A &lt;- c(3,1,2)
B &lt;- c(1,2,3)

# dot product
sum(A*B)
```

```
[1] 11
```

---

## Matrix Multiplication

**Exercise:** Take the dot product of `\(a\)` and `\(b\)`.

`\(a = [1,4,5]\)` and `\(b = [3,2,1]\)`

--

**Answer:**

`$$a \cdot b =  1 \times 3 + 4 \times 2 + 5 \times 1 = 16$$`


```r
A &lt;- c(1,4,5)
B &lt;- c(3,2,1)

# dot product
sum(A*B)
```

```
[1] 16
```

---

## Matrix Multiplication

When you multiply two matrices, you take a series of dot products.

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \end{bmatrix}\)`
]

--

Each entry in `\(AB\)` is the dot product of a column in `\(A\)` and a row in `\(B\)`.

`$$AB = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \end{bmatrix} \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \end{bmatrix} = \begin{bmatrix} &amp; \\ &amp; \end{bmatrix}$$`

---

## Matrix Multiplication

When you multiply two matrices, you take a series of dot products.

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \end{bmatrix}\)`
]

Each entry in `\(AB\)` is the dot product of a column in `\(A\)` and a row in `\(B\)`.

`$$AB = \begin{bmatrix} \color{red} 1 &amp; \color{red} 2 \\ 2 &amp; 3 \end{bmatrix} \begin{bmatrix} \color{red} 2 &amp; 1 \\ \color{red} 4 &amp; 4 \end{bmatrix} = \begin{bmatrix} \color{red} {10} &amp; \\ &amp; \end{bmatrix}$$`

---

## Matrix Multiplication

When you multiply two matrices, you take a series of dot products.

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \end{bmatrix}\)`
]

Each entry in `\(AB\)` is the dot product of a column in `\(A\)` and a row in `\(B\)`.

`$$AB = \begin{bmatrix} \color{red} 1 &amp; \color{red} 2 \\ 2 &amp; 3 \end{bmatrix} \begin{bmatrix} 2 &amp; \color{red} 1 \\ 4 &amp; \color{red} 4 \end{bmatrix} = \begin{bmatrix} 10 &amp; \color{red} 9 \\ &amp; \end{bmatrix}$$`

---

## Matrix Multiplication

When you multiply two matrices, you take a series of dot products.

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \end{bmatrix}\)`
]

Each entry in `\(AB\)` is the dot product of a column in `\(A\)` and a row in `\(B\)`.

`$$AB = \begin{bmatrix} \color{red} 1 &amp; \color{red} 2 \\ 2 &amp; 3 \end{bmatrix} \begin{bmatrix} 2 &amp; \color{red} 1 \\ 4 &amp; \color{red} 4 \end{bmatrix} = \begin{bmatrix} 10 &amp; \color{red} 9 \\ &amp; \end{bmatrix}$$`

---

## Matrix Multiplication

When you multiply two matrices, you take a series of dot products.

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \end{bmatrix}\)`
]

Each entry in `\(AB\)` is the dot product of a column in `\(A\)` and a row in `\(B\)`.

`$$AB = \begin{bmatrix} 1 &amp; 2 \\ \color{red} 2 &amp; \color{red} 3 \end{bmatrix} \begin{bmatrix} \color{red} 2 &amp; 1 \\ \color{red} 4 &amp;  4 \end{bmatrix} = \begin{bmatrix} 10 &amp; 9 \\ \color{red} {16} &amp; \end{bmatrix}$$`

---

## Matrix Multiplication

When you multiply two matrices, you take a series of dot products.

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 2 &amp; 3 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 2 &amp; 1 \\ 4 &amp; 4 \end{bmatrix}\)`
]

Each entry in `\(AB\)` is the dot product of a column in `\(A\)` and a row in `\(B\)`.

`$$AB = \begin{bmatrix} 1 &amp; 2 \\ \color{red} 2 &amp; \color{red} 3 \end{bmatrix} \begin{bmatrix} 2 &amp; \color{red} 1 \\ 4 &amp; \color{red} 4 \end{bmatrix} = \begin{bmatrix} 10 &amp; 9 \\ 16 &amp; \color{red}{14} \end{bmatrix}$$`

--

&lt;br&gt;

This is all very strange and confusing to get used to if you've never seen it before, but we'll soon see that it makes representing our multivariable linear regression problem a whole lot easier.

???

To get the entry in the first row, first column of `\(AB\)`, take the dot product of:

- The first row of `\(A\)`, and
- The first column of `\(B\)`

Then do that for every row in `\(A\)` and every column in `\(B\)`.

`$$AB = \begin{bmatrix} 1 \times 2 + 2 \times 4 &amp; 1 \times 1 + 2 \times 4 \\ 2 \times 2 + 3 \times 4 &amp; 2 \times 1 + 3 \times 4 \end{bmatrix} = \begin{bmatrix} 10 &amp; 9 \\ 16 &amp; 14 \end{bmatrix}$$`

---

## Matrix Multiplication

You can multiply matrices in `R` with the `%*%` command.


```r
A &lt;- cbind(c(1,2), c(2,3))
A
```

```
     [,1] [,2]
[1,]    1    2
[2,]    2    3
```

```r
B &lt;- cbind(c(2,4), c(1,4))
B
```

```
     [,1] [,2]
[1,]    2    1
[2,]    4    4
```

--


```r
A %*% B
```

```
     [,1] [,2]
[1,]   10    9
[2,]   16   14
```

---

## Matrix Multiplication

**Exercise:** Try multiplying these two matrices.

.pull-left[
`\(A = \begin{bmatrix} 4 &amp; 1 \\ 1 &amp; 2 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 5 &amp; 5 \\ 2 &amp; 1 \end{bmatrix}\)`
]

--

**Answer:**

`$$AB = \begin{bmatrix} 4 \times 5 + 1 \times 2 &amp; 4 \times 5 + 1 \times 1 \\ 1 \times 5 + 2 \times 2 &amp; 5 \times 1 + 1 \times 2 \end{bmatrix} = \begin{bmatrix} 22 &amp; 21 \\ 9 &amp; 7 \end{bmatrix}$$`

```r
A &lt;- cbind(c(4,1), c(1,2))
B &lt;- cbind(c(5,2), c(5,1))
A %*% B
```

```
     [,1] [,2]
[1,]   22   21
[2,]    9    7
```

---

## Matrix Multiplication

This process -- taking the dot product of rows and columns -- means that you can only multiply two matrices `\(AB\)` if the row vectors of `\(A\)` are the same length as the column vectors in `\(B\)`.

--

.pull-left[
`\(A = \begin{bmatrix} 1 &amp; 2 \\ 4 &amp; 3 \\ 1 &amp; 8 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 7 &amp; 2 \\ 4 &amp; 3 \\ 1 &amp; 2 \end{bmatrix}\)`
]

These matrices are not **conformable**! You can't take the dot product of the rows and columns.

--

### Formally

You can only multiply `\(AB\)` if the dimension of `\(A\)` is `\(m \times k\)` and the dimension of `\(B\)` is `\(k \times n\)`. The result is an `\(m \times n\)` matrix.

???

- In other words, you can only multiply `\(AB\)` if the dimension of `\(A\)` is `\(m \times k\)` and the dimension of `\(B\)` is `\(k \times n\)`.
- If this condition holds, then the two matrices are **conformable**.

---

## Matrix Multiplication

**Exercise**: Which can you multiply: `\(AB\)` or `\(BA\)`?

.pull-left[
`\(A = \begin{bmatrix} 3 &amp; 2 \\ 1 &amp; 2 \\ 2 &amp; 2 \end{bmatrix}\)`
]

.pull-right[
`\(B = \begin{bmatrix} 4 &amp; 5 &amp; 1 \\ 5 &amp; 4 &amp; 1 \end{bmatrix}\)`
]

.pull-left[

```r
A &lt;- cbind(c(3,1,2), c(2,2,2))
A
```

```
     [,1] [,2]
[1,]    3    2
[2,]    1    2
[3,]    2    2
```
]

.pull-right[

```r
B &lt;- cbind(c(4,5), c(5,4), c(1,1))
B
```

```
     [,1] [,2] [,3]
[1,]    4    5    1
[2,]    5    4    1
```
]


---

## Matrix Multiplication

**Answer:** Both!


```r
A %*% B
```

```
     [,1] [,2] [,3]
[1,]   22   23    5
[2,]   14   13    3
[3,]   18   18    4
```

```r
B %*% A
```

```
     [,1] [,2]
[1,]   19   20
[2,]   21   20
```

--

But now try `A %*% A`. I can't do it here because `R` gets so mad it won't even render my slides.


---

## Matrix Multiplication

To make matrices conformable for multiplication, sometimes you may need to take the **transpose** of a matrix. The transpose just takes the rows and turns them into columns.

.pull-left[
`$$A = \begin{bmatrix} 4 &amp; 1 \\ 1 &amp; 2 \\ 3 &amp; 3 \end{bmatrix}$$`
]

.pull-right[
`$$A' = \begin{bmatrix} 4 &amp; 1 &amp; 3 \\ 1 &amp; 2 &amp; 3 \end{bmatrix}$$`
]


```r
t(A)
```

```
     [,1] [,2] [,3]
[1,]    3    1    2
[2,]    2    2    2
```

```r
t(A) %*% A
```

```
     [,1] [,2]
[1,]   14   12
[2,]   12   12
```

---

## Matrix Multiplication

Multiplying a vector by its transpose is the same as taking the dot product with itself:

`$$a = \begin{bmatrix} 1 \\ 3 \\ 4 \end{bmatrix}$$`

`$$a \cdot a = a'a = 1 \times 1 + 3 \times 3 + 4 \times 4 = 26$$`
--

Hey, it's the **sum of squares**! That could be useful for something...

--


```r
a &lt;- c(1,3,4)

sum(a*a)
```

```
[1] 26
```

```r
t(a) %*% a
```

```
     [,1]
[1,]   26
```

---

class: center, middle

## Matrix Inversion

---

## Matrix Inversion

Before I can teach you how to **divide** matrices, I need to tell you about a very special matrix, called the **identity matrix**.

--

Remember how any number times 1 just equals the original number?

`$$a \times 1 = a$$`
This is called the **identity property**. It's what makes `\(1\)` a very special number.

--

&lt;br&gt;

The **identity matrix** `\((I)\)` is basically the `\(1\)` of matrices.

`$$AI = A$$`

You multiply any matrix by `\(I\)` and you get the same matrix back.


---

## Matrix Inversion

The identity matrix `\(I_n\)` is an `\(n \times n\)` matrix with ones in the diagonal and zeroes everywhere else.

`$$I_3 = \begin{bmatrix} 1 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 1 \end{bmatrix}$$`

--

**Exercise:** Try multiplying this matrix with the following matrix `\(A\)`.

`$$A = \begin{bmatrix} 2 &amp; 1 &amp; 5 \\ -2 &amp; 8 &amp; 100 \\ 7 &amp; 42 &amp; -42 \end{bmatrix}$$`

---

## Matrix Inversion

**Answer:**


```r
diag(3) # Create the identity matrix in R with the `diag()` function
```

```
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
```

```r
A &lt;- rbind(c(2, 1, 5),
           c(-2, 8, 100),
           c(7, 42, -2))

# multiply AI
A %*% diag(3)
```

```
     [,1] [,2] [,3]
[1,]    2    1    5
[2,]   -2    8  100
[3,]    7   42   -2
```


---

## Matrix Inversion

Hey, remember how dividing `\(\frac{a}{b}\)` is the same as multiplying `\(a \times \frac{1}{b}\)`?

--

 - `\(\frac{1}{b} = b^{-1}\)` is called the **inverse** (or reciprocal) of `\(b\)`. 

--

&lt;br&gt;

**Exercise:** What do you get when you multiply a number by its inverse?

--

- **Answer:** `\(a \times \frac{1}{a} = a^1a^{-1} = a^0 = 1\)`

--

&lt;br&gt;

There is an equivalent concept in matrix algebra, called the **matrix inverse**.

`$$AA^{-1} = I$$`
---

## Matrix Inversion

Good news! It's the 21st century. No one is going to make you solve for matrix inverses by hand.

--

There is literally a function in R called `solve()` which will do it for you.


```r
solve(A)
```

```
            [,1]         [,2]         [,3]
[1,]  0.49976292 -0.025130394 -0.007112376
[2,] -0.08250356  0.004623044  0.024893314
[3,]  0.01659554  0.009127549 -0.002133713
```

```r
A %*% solve(A) %&gt;% round
```

```
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
```

---

## Matrix Inversion

Just like there are some matrices you can't multiply together (**non-conformable** matrices), there are some matrices you can't invert (**non-invertible** or **singular** matrices).

--

`$$A = \begin{bmatrix} 1 &amp; 2 &amp; 5 \\ 2 &amp; 4 &amp; 100 \\ 3 &amp; 6 &amp; -42 \end{bmatrix}$$`

Try to `solve()` this matrix in `R`. Again, I can't show it to you here because `R` yells at me...


```r
A &lt;- rbind(c(1,2,5),
           c(2,4,100),
           c(3,6,-42))

# solve(A)
```

--

Notice that the second column is a two times the first column.

---

## Matrix Inversion

This matrix is also singular. Notice that the sum of columns 2 and 3 are a multiple of column 1. (In matrix algebra-speak, the columns are not **linearly independent**.)

`$$B = \begin{bmatrix} 1 &amp; 1 &amp; 2 \\ 2 &amp; 4 &amp; 2 \\ 3 &amp; 2 &amp; 7 \end{bmatrix}$$`


```r
B &lt;- rbind(c(1,1,2),
           c(2,4,2),
           c(3,2,7))

# solve(B)
```

???

I bring this up, dear reader, because there will come a day when you will want to invert a matrix and you will not be able to, because your columns are perfectly correlated with each other! (It's called multicollinearity, and I'll let Mollie tell you all about it.)

---

## Matrix Inversion

Now that we know how to multiply by an inverse, we have what we need to perform matrix algebra.

**Exercise:** Solve this equation for `\(A\)`.

`$$AB = C$$`

--

**Answer:** Multiply both sides by `\(B^{-1}\)`

`$$ABB^{-1} = CB^{-1}$$`

`$$AI = CB^{-1}$$`

&lt;br&gt;

`$$A = CB^{-1}$$`
---

## Matrix Inversion

Watch out for conformability! With matrices, it matters whether you multiply on the right or the left.

**Exercise:** Solve for `\(B\)`.

`$$AB = C$$`
--

**Answer:**

`$$A^{-1}AB = A^{-1}C$$`

`$$IB = A^{-1}C$$`
&lt;br&gt;

`$$B = A^{-1}C$$`
--

`$$B \neq CA^{-1}$$`


---

class: center, middle

## Back to Multivariable Linear Regression


---

## Multivariable Linear Regression

This is the regression problem we wanted to solve:

`$$\underbrace{\begin{bmatrix} 19 \\ 36 \\ 36 \\ \vdots \\ 24 \end{bmatrix}}_\text{corruption} = \underbrace{\alpha \times \begin{bmatrix} 1 \\ 1 \\1 \\ \vdots \\ 1 \end{bmatrix}}_\alpha + \underbrace{\beta_1 \times \begin{bmatrix} 0 \\ 1 \\ 0 \\ \vdots \\ 0 \end{bmatrix}}_{\beta_1 \text{democracy}} + \underbrace{\beta_2 \times \begin{bmatrix} 2,156 \\ 14,648 \\ 12,019 \\ \vdots \\ 2,961 \end{bmatrix}}_{\beta_2 \text{GDP}} +  \underbrace{\begin{bmatrix} \varepsilon_1 \\ \varepsilon_2 \\ \varepsilon_3 \\ \vdots \\ \varepsilon_n \end{bmatrix}}_\varepsilon$$`

--

Notice that we can restate it as a matrix multiplication problem:

`$$\underbrace{\begin{bmatrix} 19 \\ 36 \\ 36 \\ \vdots \\ 24 \end{bmatrix}}_\text{corruption} = \underbrace{\begin{bmatrix} 1 &amp; 0 &amp; 2,156 \\ 1 &amp; 1 &amp; 14,648 \\ 1 &amp; 0 &amp; 12,019 \\ \vdots &amp; \vdots &amp; \vdots \\ 1 &amp; 0 &amp; 2,961 \end{bmatrix}}_X \underbrace{\begin{bmatrix} \alpha \\ \beta_1 \\ \beta_2 \end{bmatrix}}_\beta + \underbrace{\begin{bmatrix} \varepsilon_1 \\ \varepsilon_2 \\ \varepsilon_3 \\ \vdots \\ \varepsilon_n \end{bmatrix}}_\varepsilon = X\beta + \varepsilon$$`

???

How do you simultaneously estiamte `\(\alpha\)`, `\(\beta_1\)`, and `\(\beta_2\)`?

---

## Multivariable Linear Regression

`\(X\beta\)` is an `\(n \times 1\)` vector of predicted values, and `\(\varepsilon\)` is an `\(n \times 1\)` vector of errors.

`$$Y = X\beta + \varepsilon$$`

--

Just like before, we want to minimize the sum of squared errors:

`$$\varepsilon \cdot \varepsilon = \varepsilon'\varepsilon = (Y - X\beta)'(Y-X\beta)$$`
--

Minimizing this expression follows the same three steps we used with scalar calculus. Just be careful with matrix multiplication and division. Start by distributing the function:

`$$f(X,Y,\beta) = (Y - X\beta)'(Y-X\beta) = Y'Y - 2(X\beta)'Y + (X\beta)'X\beta$$`
---

## Estimating The Regression Parameters

**Step 1: Take the derivative with respect to `\(\beta\)`**

`$$f(X,Y,\beta) = Y'Y - 2(X\beta)'Y + (X\beta)'X\beta$$`

`$$\frac{\partial f}{\partial \beta} = -2X'Y + 2 X'X \beta$$` 

--

**Step 2: Set the derivative equal to zero**

`$$-2X'Y + 2 X'X \beta = 0$$`
--

**Step 3: Solve for `\(\beta\)`**

`$$2 X'X \beta = 2 X'Y$$`
`$$\hat{\beta} = (X'X)^{-1} X'Y$$` 

---

## The Ordinary Least Squares (OLS) Estimator

&lt;br&gt;

&lt;br&gt;

&lt;br&gt;

### `$$\hat{\beta} = (X'X)^{-1} X'Y$$` 

---

## Now We Can Estimate...


```r
# drop the missing values
d &lt;- filter(d, complete.cases(d))

# create the Y vector
Y &lt;- d$cpi_score

# create the X matrix
X &lt;- d %&gt;% 
  select(democracy, gdp_per_capita) %&gt;% 
  mutate(intercept = 1) %&gt;% 
  as.matrix

head(X)
```

```
     democracy gdp_per_capita intercept
[1,]         1       62134.03         1
[2,]         1       44814.31         1
[3,]         1       53159.14         1
[4,]         0      101649.07         1
[5,]         1       56668.32         1
[6,]         1       72372.24         1
```

---

## Now We Can Estimate...

The vector of estimates that minimizes the sum of squared errors equals `\((X'X)^{-1}(X'Y)\)`:


```r
beta_hat &lt;- solve(t(X) %*% X) %*% t(X) %*% Y

beta_hat
```

```
                       [,1]
democracy       8.873370295
gdp_per_capita  0.000623775
intercept      23.672945358
```

--


```r
lm(cpi_score ~ democracy + gdp_per_capita, data = d)
```

```

Call:
lm(formula = cpi_score ~ democracy + gdp_per_capita, data = d)

Coefficients:
   (Intercept)       democracy  gdp_per_capita  
     2.367e+01       8.873e+00       6.238e-04  
```

---

## What's Going On Here?

Previously, we showed that the line of best fit between `cpi_score` and `democracy` had this slope:


```r
lm1 &lt;- lm(cpi_score ~ democracy, data = d)
coef(lm1)
```

```
(Intercept)   democracy 
     34.000      13.875 
```

--

Now the slope is almost half that...


```r
lm2 &lt;- lm(cpi_score ~ democracy + gdp_per_capita, data = d)
coef(lm2)
```

```
   (Intercept)      democracy gdp_per_capita 
  23.672945358    8.873370295    0.000623775 
```

...suggesting that the observed relationship between democracy and corruption was partially confounded by national income!

---

class: center, middle

# Looking Forward

---

## Limitations

There are some important limitations to the approach we just took. In order for your causal inference to be credible, you need to believe two major things:

--

1. The relationship between your predictors and your outcome is not *nonlinear* in some way.

2. You've identified *all* of the significant back door paths and closed them off.

--

&lt;br&gt;

If you're worried about number 1, there are some diagnostic tests you can run (more on that in POLS 7014) or you could try something like **matching** methods (Chapter 14 of *The Effect*).

--

&lt;br&gt;

If you're worried about number 2, then next week will be awesome for you! 


---

## Next Week: Walking Through The Front Door


```r
dagify(X ~ Z + U,
       Y ~ X + U) %&gt;% 
  ggdag_classic() + theme_dag()
```

&lt;img src="09-regression_files/figure-html/unnamed-chunk-10-1.png" width="600" style="display: block; margin: auto;" /&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
